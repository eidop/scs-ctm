<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SCS CTM Platform v11</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Mono:wght@300;400;500&family=Instrument+Sans:wght@400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
/* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” TOKENS â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
:root{
  --bg:#070a0e; --s:#0d1119; --s2:#131a23; --s3:#19202c;
  --b:rgba(255,255,255,0.055); --b2:rgba(255,255,255,0.1);
  --g:#00e5a0; --b1:#2f8bff; --o:#ff6b35; --pu:#9d60fb; --au:#f59e0b;
  --tx:#e2e6f0; --mu:#48556a; --m2:#8490a8;
  --er:#ff3d3d; --wa:#ffaa00;
  --t1:#00e5a0; --t1b:rgba(0,229,160,0.07); --t1e:rgba(0,229,160,0.2);
  --t2:#2f8bff; --t2b:rgba(47,139,255,0.07); --t2e:rgba(47,139,255,0.2);
  --t3:#f59e0b; --t3b:rgba(245,158,11,0.07); --t3e:rgba(245,158,11,0.2);
}
*{margin:0;padding:0;box-sizing:border-box;}
html,body{height:100%;}
body{font-family:'Instrument Sans',sans-serif;background:var(--bg);color:var(--tx);overflow-x:hidden;}

/* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” APP LAYERS â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
#v-login,#v-admin,#v-client{display:none;min-height:100vh;}
#v-login.on{display:flex;}
#v-admin.on{display:flex;}
#v-client.on{display:block;}

/* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” LOGIN â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
#v-login{align-items:center;justify-content:center;background:var(--bg);position:relative;overflow:hidden;}
.orb{position:absolute;border-radius:50%;filter:blur(90px);pointer-events:none;}
.o1{width:600px;height:600px;background:rgba(0,229,160,0.03);top:-150px;left:-150px;}
.o2{width:500px;height:500px;background:rgba(47,139,255,0.04);bottom:-100px;right:-100px;}
.o3{width:350px;height:350px;background:rgba(245,158,11,0.025);top:30%;left:35%;}

.lw{position:relative;z-index:10;width:440px;max-width:94vw;}
.l-logo{text-align:center;margin-bottom:36px;}
.l-mark{font-family:'Instrument Sans',sans-serif;font-weight:700;font-size:26px;letter-spacing:-0.5px;}
.l-mark span{color:var(--g);}
.l-sub{font-family:'DM Mono',monospace;font-size:10px;color:var(--mu);letter-spacing:2.5px;text-transform:uppercase;margin-top:6px;}
.l-card{background:var(--s);border:1px solid var(--b2);border-radius:18px;padding:30px;box-shadow:0 40px 100px rgba(0,0,0,0.5);}
.l-head{font-family:'Instrument Sans',sans-serif;font-weight:700;font-size:20px;margin-bottom:3px;}
.l-desc{font-size:12.5px;color:var(--m2);margin-bottom:22px;}

.rtabs{display:flex;background:var(--s2);border-radius:10px;padding:3px;margin-bottom:22px;gap:2px;}
.rtab{flex:1;padding:9px;text-align:center;border-radius:8px;cursor:pointer;font-size:12.5px;font-weight:600;color:var(--m2);transition:all 0.18s;user-select:none;}
.rtab.on{background:var(--s3);color:var(--tx);}
.rtab.on.at{color:var(--g);}
.rtab.on.ct{color:var(--b1);}

.fg{margin-bottom:14px;}
.fl{font-size:11.5px;font-weight:600;color:var(--m2);margin-bottom:5px;display:block;}
.fi{width:100%;background:var(--s2);border:1px solid var(--b2);border-radius:8px;padding:10px 13px;font-size:13px;color:var(--tx);font-family:'Instrument Sans',sans-serif;outline:none;transition:all 0.15s;}
.fi:focus{border-color:var(--g);box-shadow:0 0 0 3px rgba(0,229,160,0.07);}
.fi.cf:focus{border-color:var(--b1);box-shadow:0 0 0 3px rgba(47,139,255,0.07);}

.lbtn{width:100%;padding:12px;border-radius:10px;font-family:'Instrument Sans',sans-serif;font-weight:700;font-size:14px;cursor:pointer;border:none;transition:all 0.2s;margin-top:4px;display:flex;align-items:center;justify-content:center;gap:8px;}
.lbtn-a{background:var(--g);color:#000;}
.lbtn-a:hover{background:#00ffaa;transform:translateY(-1px);box-shadow:0 8px 28px rgba(0,229,160,0.3);}
.lbtn-c{background:var(--b1);color:#fff;}
.lbtn-c:hover{background:#5aa3ff;transform:translateY(-1px);box-shadow:0 8px 28px rgba(47,139,255,0.3);}

.l-hints{margin-top:18px;border-top:1px solid var(--b);padding-top:16px;display:flex;flex-direction:column;gap:7px;}
.l-hl{font-family:'DM Mono',monospace;font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--mu);margin-bottom:3px;}
.hint{display:flex;align-items:center;gap:11px;padding:9px 12px;background:var(--s2);border:1px solid var(--b);border-radius:8px;cursor:pointer;transition:all 0.15s;}
.hint:hover{border-color:var(--b2);background:var(--s3);}
.hint-role{font-family:'DM Mono',monospace;font-size:9.5px;letter-spacing:1px;text-transform:uppercase;}
.hint-creds{font-size:11.5px;color:var(--mu);font-family:'DM Mono',monospace;margin-top:1px;}
.hint-arrow{margin-left:auto;font-size:11px;opacity:0.6;}
.lerr{background:rgba(255,61,61,0.08);border:1px solid rgba(255,61,61,0.2);border-radius:8px;padding:9px 13px;font-size:12px;color:var(--er);margin-bottom:14px;display:none;}
.lerr.on{display:block;}

/* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” ADMIN SHELL â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
#v-admin{flex-direction:row;}
.asb{width:250px;min-height:100vh;background:var(--s);border-right:1px solid var(--b);display:flex;flex-direction:column;position:fixed;left:0;top:0;bottom:0;z-index:100;overflow-y:auto;}
.asb::before{content:'';position:absolute;left:0;top:0;bottom:0;width:2px;background:linear-gradient(180deg,transparent 0%,var(--g) 40%,var(--g) 60%,transparent 100%);opacity:0.25;}
.asb-logo{padding:22px 20px 14px;border-bottom:1px solid var(--b);flex-shrink:0;}
.asb-mark{font-family:'Syne',sans-serif;font-weight:800;font-size:15.5px;letter-spacing:-0.4px;}
.asb-mark span{color:var(--g);}
.asb-sub{font-family:'DM Mono',monospace;font-size:9px;color:var(--mu);letter-spacing:2px;text-transform:uppercase;margin-top:3px;}
.asb-mode{margin:10px 14px 0;background:rgba(0,229,160,0.07);border:1px solid var(--t1e);border-radius:7px;padding:5px 10px;font-family:'DM Mono',monospace;font-size:9.5px;letter-spacing:1.5px;text-transform:uppercase;color:var(--g);display:flex;align-items:center;gap:7px;}
.asb-pulse{width:6px;height:6px;border-radius:50%;background:var(--g);flex-shrink:0;animation:pulse 1.5s infinite;}
.anav{padding:12px 10px;flex:1;}
.asl{font-family:'DM Mono',monospace;font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--mu);padding:10px 12px 4px;}
.ani{display:flex;align-items:center;gap:9px;padding:8px 12px;border-radius:8px;cursor:pointer;font-size:13px;font-weight:500;color:var(--m2);transition:all 0.15s;margin-bottom:1px;user-select:none;}
.ani:hover{background:var(--s2);color:var(--tx);}
.ani.on{background:rgba(0,229,160,0.09);color:var(--g);}
.ani .ic{width:16px;text-align:center;font-size:13px;flex-shrink:0;}
.nbg{margin-left:auto;font-size:10px;font-weight:700;padding:1px 7px;border-radius:20px;font-family:'DM Mono',monospace;}
.ng{background:var(--g);color:#000;}
.nb{background:var(--b1);color:#fff;}
.nw{background:var(--wa);color:#000;}
.nr{background:var(--er);color:#fff;}
.asb-foot{padding:12px;border-top:1px solid var(--b);flex-shrink:0;}
.auc{display:flex;align-items:center;gap:9px;padding:9px 10px;border-radius:9px;background:var(--s2);cursor:pointer;transition:all 0.15s;}
.auc:hover{background:var(--s3);}
.aua{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,var(--g),var(--b1));display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:800;color:#000;flex-shrink:0;border:2px solid rgba(0,229,160,0.3);}
.aun{font-size:12px;font-weight:700;}
.aur{font-size:10px;color:var(--g);font-family:'DM Mono',monospace;}
.amain{margin-left:250px;flex:1;min-height:100vh;}
.atb{background:var(--s);border-bottom:1px solid var(--b);padding:13px 26px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:50;}
.apt{font-family:'Instrument Sans',sans-serif;font-weight:700;font-size:17px;letter-spacing:-0.3px;display:flex;align-items:center;gap:10px;}
.ac{padding:22px 26px;}

/* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” CLIENT SHELL â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
#v-client{background:#050810;}
.c-topstrip{height:3px;background:linear-gradient(90deg,var(--b1),var(--pu),transparent);}
.ctb{background:#0a0e18;border-bottom:1px solid rgba(47,139,255,0.14);padding:0 28px;height:58px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;}
.c-mark{font-family:'Instrument Sans',sans-serif;font-weight:600;font-size:15px;letter-spacing:-0.4px;}
.c-mark span{color:var(--b1);}
.c-sep{width:1px;height:20px;background:rgba(47,139,255,0.18);}
.cnav{display:flex;gap:2px;}
.cni{padding:6px 13px;border-radius:7px;cursor:pointer;font-size:13px;font-weight:500;color:var(--m2);transition:all 0.15s;user-select:none;}
.cni:hover{background:rgba(255,255,255,0.04);color:var(--tx);}
.cni.on{background:rgba(47,139,255,0.1);color:var(--b1);}
.ctbr{display:flex;align-items:center;gap:12px;}
.c-cbadge{display:flex;align-items:center;gap:8px;padding:5px 13px;background:rgba(47,139,255,0.08);border:1px solid rgba(47,139,255,0.18);border-radius:8px;font-size:12px;font-weight:600;color:var(--b1);}
.c-tbadge{padding:2px 7px;background:rgba(47,139,255,0.14);border-radius:4px;font-family:'DM Mono',monospace;font-size:9px;letter-spacing:0.5px;}
.c-av{width:30px;height:30px;border-radius:50%;background:linear-gradient(135deg,var(--b1),var(--pu));display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:800;color:#fff;}
.c-content{padding:22px 28px;max-width:1220px;}

/* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” TIER BANNERS â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
.tier-alert{background:rgba(255,170,0,0.07);border:1.5px solid rgba(255,170,0,0.3);border-radius:13px;padding:16px 20px;display:flex;align-items:center;gap:14px;margin-bottom:20px;animation:alertPulse 3s ease-in-out infinite;}
@keyframes alertPulse{0%,100%{border-color:rgba(255,170,0,0.3)}50%{border-color:rgba(255,170,0,0.6)}}
.ta-icon{font-size:28px;flex-shrink:0;}
.ta-text{flex:1;}
.ta-title{font-family:'Instrument Sans',sans-serif;font-weight:700;font-size:14.5px;color:var(--wa);margin-bottom:3px;}
.ta-desc{font-size:12.5px;color:var(--m2);}
.ta-btn{background:var(--wa);color:#000;border:none;padding:9px 18px;border-radius:8px;font-family:'Instrument Sans',sans-serif;font-weight:700;font-size:13px;cursor:pointer;flex-shrink:0;transition:all 0.15s;}
.ta-btn:hover{background:#ffcc00;transform:translateY(-1px);}
.tier-warn{background:rgba(255,107,53,0.06);border:1px solid rgba(255,107,53,0.25);border-radius:10px;padding:11px 14px;display:flex;align-items:center;gap:10px;margin-bottom:16px;font-size:12.5px;}
.tw-icon{font-size:18px;flex-shrink:0;}

/* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” SHARED COMPONENTS â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
.btn{padding:7px 15px;border-radius:7px;font-size:12.5px;font-weight:600;cursor:pointer;border:none;transition:opacity .12s,transform .1s,background .15s,border-color .15s;font-family:'Instrument Sans',sans-serif;}
.btn:active{transform:scale(.97);opacity:.85;}
.btn-g{background:var(--g);color:#000;}
.btn-g:hover{background:#00ffaa;transform:translateY(-1px);}
.btn-b{background:var(--b1);color:#fff;}
.btn-b:hover{background:#5aa3ff;transform:translateY(-1px);}
.btn-gh{background:transparent;color:var(--m2);border:1px solid var(--b2);}
.btn-gh:hover{background:var(--s2);color:var(--tx);}
.btn-er{background:rgba(255,61,61,0.1);color:var(--er);border:1px solid rgba(255,61,61,0.2);}
.btn-er:hover{background:rgba(255,61,61,0.2);}
.btn-wa{background:rgba(255,170,0,0.15);color:var(--wa);border:1px solid rgba(255,170,0,0.25);}
.btn-wa:hover{background:rgba(255,170,0,0.25);}
.btn-sm{padding:5px 11px;font-size:11.5px;}

/* Pages */
.pg{display:none;}.pg.on{display:block;}
.cpg{display:none;}.cpg.on{display:block;}

/* Cards */
.card{background:var(--s);border:1px solid var(--b);border-radius:12px;overflow:hidden;}
.ch{padding:14px 18px;border-bottom:1px solid var(--b);display:flex;align-items:center;justify-content:space-between;}
.ct{font-family:'Instrument Sans',sans-serif;font-weight:700;font-size:13.5px;}
.ccard{background:#0a0e18;border:1px solid rgba(47,139,255,0.08);border-radius:12px;overflow:hidden;}
.cch{padding:13px 16px;border-bottom:1px solid rgba(47,139,255,0.07);display:flex;align-items:center;justify-content:space-between;}
.cct{font-family:'Instrument Sans',sans-serif;font-weight:700;font-size:13px;}

/* Stat cards */
.sc{background:var(--s);border:1px solid var(--b);border-radius:11px;padding:16px 18px;position:relative;overflow:hidden;}
.sc::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:var(--ca,var(--g));opacity:0.7;}
.csc{background:#0a0e18;border:1px solid rgba(47,139,255,0.1);border-radius:11px;padding:16px 18px;position:relative;overflow:hidden;}
.csc::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:var(--ca,var(--b1));opacity:0.7;}
.slbl{font-family:'DM Mono',monospace;font-size:9px;letter-spacing:1.2px;text-transform:uppercase;color:var(--mu);margin-bottom:8px;}
.sval{font-family:'Instrument Sans',sans-serif;font-size:22px;font-weight:600;letter-spacing:0;margin-bottom:4px;line-height:1.1;}
.schg{font-size:11px;font-family:'DM Mono',monospace;}
.sup{color:var(--g);}.sdn{color:var(--er);}.smt{color:var(--mu);}

/* Grids */
.g4{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:16px;}
.g3{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:16px;}
.g2{display:grid;grid-template-columns:1fr 1fr;gap:13px;}
.gms{display:grid;grid-template-columns:1fr 290px;gap:13px;}
.col{display:flex;flex-direction:column;gap:13px;}

/* Table */
.tw{overflow-x:auto;}
table{width:100%;border-collapse:collapse;}
thead tr{border-bottom:1px solid var(--b);}
th{padding:9px 14px;font-family:'DM Mono',monospace;font-size:9.5px;letter-spacing:1.5px;text-transform:uppercase;color:var(--mu);font-weight:500;text-align:left;}
td{padding:11px 14px;font-size:12.5px;border-bottom:1px solid var(--b);}
tr:last-child td{border-bottom:none;}
tr:hover td{background:rgba(255,255,255,0.012);}
.tmn{font-family:'DM Mono',monospace;font-size:11px;color:var(--m2);}
.av{width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:800;flex-shrink:0;}

/* Badges */
.bge{padding:3px 8px;border-radius:20px;font-size:10px;font-weight:700;font-family:'DM Mono',monospace;letter-spacing:0.5px;display:inline-block;}
.ba{background:rgba(0,229,160,0.1);color:var(--g);border:1px solid var(--t1e);}
.bp{background:rgba(255,170,0,0.1);color:var(--wa);border:1px solid rgba(255,170,0,0.2);}
.bd{background:rgba(78,86,104,0.2);color:var(--m2);border:1px solid var(--b2);}
.be{background:rgba(255,61,61,0.1);color:var(--er);border:1px solid rgba(255,61,61,0.2);}
.bt1{background:var(--t1b);color:var(--t1);border:1px solid var(--t1e);}
.bt2{background:var(--t2b);color:var(--t2);border:1px solid var(--t2e);}
.bt3{background:var(--t3b);color:var(--t3);border:1px solid var(--t3e);}

/* Tags */
.tag{font-family:'DM Mono',monospace;font-size:10px;padding:3px 8px;border-radius:20px;}
.tg{background:rgba(0,229,160,0.1);color:var(--g);border:1px solid var(--t1e);}
.tb{background:rgba(47,139,255,0.1);color:var(--b1);border:1px solid var(--t2e);}
.tw2{background:rgba(255,170,0,0.1);color:var(--wa);border:1px solid rgba(255,170,0,0.2);}
.tr-badge{display:inline-flex;align-items:center;gap:5px;font-family:'DM Mono',monospace;font-size:10px;padding:3px 9px;border-radius:20px;}
.tr-g{color:var(--g);background:rgba(0,229,160,0.08);border:1px solid var(--t1e);}
.tr-b{color:var(--b1);background:rgba(47,139,255,0.08);border:1px solid var(--t2e);}

/* Progress */
.pb{height:5px;background:var(--s3);border-radius:3px;overflow:hidden;}
.pbf{height:100%;border-radius:3px;transition:width 0.9s ease;}
.pb-tall{height:8px;}

/* Form */
.fgl{font-size:11.5px;font-weight:600;color:var(--m2);margin-bottom:5px;display:block;}
.fgi{width:100%;background:var(--s2);border:1px solid var(--b2);border-radius:8px;padding:9px 12px;font-size:12.5px;color:var(--tx);font-family:'Instrument Sans',sans-serif;outline:none;transition:border 0.15s;}
.fgi:focus{border-color:var(--g);box-shadow:0 0 0 3px rgba(0,229,160,0.06);}
.fgs{width:100%;background:var(--s2);border:1px solid var(--b2);border-radius:8px;padding:9px 12px;font-size:12.5px;color:var(--tx);font-family:'Instrument Sans',sans-serif;outline:none;}
.fgs option{background:var(--s2);}
.fgt{width:100%;background:var(--s2);border:1px solid var(--b2);border-radius:8px;padding:9px 12px;font-size:12.5px;color:var(--tx);font-family:'Instrument Sans',sans-serif;outline:none;resize:vertical;min-height:80px;}
.fg2{display:grid;grid-template-columns:1fr 1fr;gap:11px;margin-bottom:11px;}
.fg1{margin-bottom:12px;}

/* Toggle */
.trow{display:flex;align-items:center;justify-content:space-between;padding:9px 0;border-bottom:1px solid var(--b);}
.trow:last-child{border-bottom:none;}
.tlbl{font-size:13px;font-weight:500;}
.tog{position:relative;width:38px;height:21px;flex-shrink:0;}
.tog input{opacity:0;width:0;height:0;}
.ts{position:absolute;cursor:pointer;inset:0;background:var(--s3);border:1px solid var(--b2);border-radius:21px;transition:.2s;}
.ts:before{position:absolute;content:"";height:15px;width:15px;left:2px;bottom:2px;background:var(--mu);border-radius:50%;transition:.2s;}
.tog input:checked+.ts{background:rgba(0,229,160,0.18);border-color:var(--g);}
.tog input:checked+.ts:before{transform:translateX(17px);background:var(--g);}

/* Mini chart */
.mc{display:flex;align-items:flex-end;gap:2.5px;height:36px;}
.mcb{flex:1;border-radius:2px 2px 0 0;}

/* Log */
.loge{display:flex;gap:14px;padding:7px 16px;border-bottom:1px solid var(--b);font-family:'DM Mono',monospace;font-size:10.5px;}
.loge:last-child{border-bottom:none;}
.lt{color:var(--mu);flex-shrink:0;width:145px;}
.ll{flex-shrink:0;width:55px;}
.lok{color:var(--g);}.lin{color:var(--b1);}.lwa{color:var(--wa);}.ler{color:var(--er);}

/* Activity feed */
.ai{padding:9px 16px;display:flex;align-items:flex-start;gap:10px;border-bottom:1px solid var(--b);}
.ai:last-child{border-bottom:none;}
.aic{width:26px;height:26px;border-radius:7px;display:flex;align-items:center;justify-content:center;font-size:11px;flex-shrink:0;margin-top:1px;}

/* Client feed */
.ti{padding:11px 16px;border-bottom:1px solid rgba(47,139,255,0.06);display:flex;align-items:flex-start;gap:11px;}
.ti:last-child{border-bottom:none;}
.tibg{padding:3px 8px;border-radius:5px;font-size:10px;font-weight:700;font-family:'DM Mono',monospace;letter-spacing:0.5px;flex-shrink:0;margin-top:2px;}
.tiau{background:rgba(0,229,160,0.1);color:var(--g);border:1px solid var(--t1e);}
.tiwa{background:rgba(255,170,0,0.1);color:var(--wa);border:1px solid rgba(255,170,0,0.2);}
.tinw{background:rgba(47,139,255,0.1);color:var(--b1);border:1px solid var(--t2e);}

/* Voice viz */
@keyframes voiceA{0%,100%{height:5px;opacity:0.3}50%{height:34px;opacity:1}}
.vbar{width:4px;border-radius:4px;background:var(--g);animation:voiceA 1.2s ease-in-out infinite;}
.vviz{display:flex;align-items:center;gap:3px;height:44px;}

/* Modal */
.mo{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.8);z-index:200;align-items:center;justify-content:center;backdrop-filter:blur(6px);}
.mo.on{display:flex;}
.mbox{background:var(--s);border:1px solid var(--b2);border-radius:18px;width:min(480px,92vw);max-height:90vh;overflow-y:auto;box-shadow:0 32px 80px rgba(0,0,0,.65);animation:fadeUp .22s ease;}
.mhd{padding:20px 22px 0;display:flex;align-items:center;justify-content:space-between;}
.mti{font-family:'Instrument Sans',sans-serif;font-weight:700;font-size:16px;}
.mcl{background:none;border:none;color:var(--mu);cursor:pointer;font-size:16px;padding:4px 6px;border-radius:6px;transition:color .15s;line-height:1;}
.mcl:hover{color:var(--tx);}
.mbd{padding:18px 22px;}
.mft{padding:14px 22px 20px;display:flex;justify-content:flex-end;gap:9px;border-top:1px solid var(--b);}

/* Animations */
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.3}}
@keyframes flashN{0%{background:rgba(0,229,160,0.1)}100%{background:transparent}}
@keyframes flashNB{0%{background:rgba(47,139,255,0.1)}100%{background:transparent}}
@keyframes fadeIn{from{opacity:0;transform:translateY(5px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
@keyframes countUp{from{transform:translateY(5px);opacity:0}to{transform:translateY(0);opacity:1}}
@keyframes pulseRow{0%{background:rgba(0,229,160,.09)}100%{background:transparent}}
@keyframes alertPulse2{0%,100%{border-color:rgba(255,170,0,0.3)}50%{border-color:rgba(255,170,0,0.6)}}

.ld{display:inline-block;width:6px;height:6px;background:var(--g);border-radius:50%;animation:pulse 1.5s infinite;vertical-align:middle;}
.ld-b{background:var(--b1);}
.anim-v{animation:countUp 0.3s ease forwards;}
.fn{animation:flashN 1.5s ease forwards;}
.fnb{animation:flashNB 1.5s ease forwards;}
.new-row{animation:pulseRow 1.2s ease;}

::-webkit-scrollbar{width:4px;}
::-webkit-scrollbar-track{background:transparent;}
::-webkit-scrollbar-thumb{background:var(--b2);border-radius:4px;}

/* API key row */
.akr{display:flex;align-items:center;gap:9px;background:var(--s2);border:1px solid var(--b2);border-radius:7px;padding:9px 12px;}
.akv{font-family:'DM Mono',monospace;font-size:11.5px;color:var(--m2);flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
</style>
</head>
<body>

<!-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     â•‘  LOGIN
     â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="v-login" class="on">
  <div class="orb o1"></div><div class="orb o2"></div><div class="orb o3"></div>
  <div class="lw">
    <div class="l-logo">
      <div class="l-mark">Simply<span>Complex</span></div>
      <div class="l-sub">CTM Platform v11</div>
    </div>
    <div class="l-card">
      <div class="l-head">Logg inn</div>
      <div class="l-desc">Velg kontotype for Ã¥ komme i gang</div>
      <div class="rtabs">
        <div class="rtab at on" id="rtab-admin">ğŸ” &nbsp;SCS Admin</div>
        <div class="rtab ct" id="rtab-client">ğŸ‘¤ &nbsp;Klient-portal</div>
      </div>
      <div class="lerr" id="lerr">Feil e-post eller passord. PrÃ¸v igjen.</div>
      <div class="fg">
        <label class="fl">E-post</label>
        <input class="fi" id="lin-em" type="email" placeholder="din@email.no">
      </div>
      <div class="fg">
        <label class="fl">Passord</label>
        <input class="fi" id="lin-pw" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
      </div>
      <div style="text-align:right;margin-top:-8px;margin-bottom:10px;"><span id="l-forgot" style="font-size:11px;color:var(--mu);cursor:pointer;">Glemt passord?</span></div>
      <button class="lbtn lbtn-a" id="lbtn">
        <span id="lbtn-ic">âš¡</span> <span id="lbtn-tx">Logg inn som Admin</span>
      </button>
    </div>
  </div>
</div>

<!-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     â•‘  ADMIN APP
     â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="v-admin">
  <aside class="asb">
    <div class="asb-logo">
      <div class="asb-mark">Simply<span>Complex</span></div>
      <div class="asb-sub">CTM Platform v11</div>
    </div>
    <div class="asb-mode">
      <div class="asb-pulse"></div>
      <span id="conn-badge">Produksjon</span>
    </div>
    <nav class="anav">
      <div class="asl">Oversikt</div>
      <div class="ani on" data-page="a-db"><span class="ic">âš¡</span>Dashboard</div>
      <div class="ani" data-page="a-tiers"><span class="ic">ğŸ“Š</span>Avtaler & ROI</div>
      <div class="ani" data-page="a-kl"><span class="ic">ğŸ‘¥</span>Klienter<span class="nbg ng" id="sb-cl">12</span></div>
      <div class="ani" data-page="a-fak"><span class="ic">ğŸ’³</span>Fakturering</div>

      <div class="asl">Agenter & Kanaler</div>
      <div class="ani" data-page="a-ag"><span class="ic">ğŸ¤–</span>Agenter<span class="nbg ng" id="sb-ag">10</span></div>
      <div class="ani" data-page="a-ny"><span class="ic">âœ¨</span>Ny agent</div>
      <div class="ani" data-page="a-int"><span class="ic">ğŸ”—</span>Integrasjoner</div>
      <div class="ani" data-page="a-email"><span class="ic">ğŸ“¬</span>Email</div>
      <div class="ani" data-page="a-voice"><span class="ic">ğŸ“</span>Voice</div>
      <div class="ani" data-page="a-crm"><span class="ic">ğŸ¢</span>CRM</div>

      <div class="asl">System</div>
      <div class="ani" data-page="a-api"><span class="ic">ğŸ’¸</span>API-kostnader</div>
      <div class="ani" data-page="a-usr"><span class="ic">ğŸ”‘</span>Brukere</div>
      <div class="ani" data-page="a-log"><span class="ic">ğŸ“‹</span>Logg<span class="nbg nw" id="sb-log">5</span></div>
      <div class="ani" data-page="a-set"><span class="ic">âš™ï¸</span>Innstillinger</div>
    </nav>
    <div class="asb-foot">
      <div class="auc" id="a-logout-btn">
        <div class="aua" id="a-av">E</div>
        <div style="flex:1;min-width:0;">
          <div class="aun" id="a-uname">Eido</div>
          <div class="aur">SCS ADMIN</div>
        </div>
        <div style="font-size:12px;color:var(--mu);" title="Logg ut">â‡¥</div>
      </div>
    </div>
  </aside>

  <main class="amain">

    <!-- â”€â”€ DASHBOARD â”€â”€ -->
    <section class="pg on" id="pg-a-db">
      <div class="atb">
        <div class="apt">âš¡ Dashboard <span class="tr-badge tr-g" style="margin-left:4px;"><span class="ld"></span> Sanntid</span></div>
        <div style="display:flex;align-items:center;gap:10px;">
          <div style="font-family:'DM Mono',monospace;font-size:11px;color:var(--mu);" id="a-clk">--:--:--</div>
          <button class="btn btn-g btn-sm" data-goto="a-ny">+ Ny agent</button>
        </div>
      </div>
      <div class="ac">
        <div class="g4">
          <div class="sc" style="--ca:var(--g)"><div class="slbl">Aktive agenter</div><div class="sval" id="adb-ag">10</div><div class="schg sup">â†‘ sanntid</div></div>
          <div class="sc" style="--ca:var(--b1)"><div class="slbl">Handlinger i dag</div><div class="sval" id="adb-act">3 089</div><div class="schg sup">â†‘ live</div></div>
          <div class="sc" style="--ca:var(--o)"><div class="slbl">Leads i dag</div><div class="sval" id="adb-leads">105</div><div class="schg sup">â†‘ live</div></div>
          <div class="sc" style="--ca:var(--au)"><div class="slbl">Totale klienter</div><div class="sval" id="adb-cl">12</div><div class="schg smt">aktive</div></div>
        </div>

        <div class="gms" style="margin-bottom:13px;">
          <div class="col">
            <div class="card">
              <div class="ch"><div class="ct">Alle agenter â€” live ytelse</div><span class="tr-badge tr-g"><span class="ld"></span> Live</span></div>
              <div class="tw"><table>
                <thead><tr><th>Agent</th><th>Klient</th><th>Handlinger</th><th>Rate</th><th>Status</th></tr></thead>
                <tbody>
                  <tr><td><div style="font-weight:600;">Email Support</div><div class="tmn">ğŸ“¬ Gmail Â· HubSpot</div></td><td class="tmn">Regnskap AS</td><td class="tmn" id="aa1">412</td><td style="color:var(--g);font-family:'DM Mono',monospace;font-size:11px;">96%</td><td><span class="bge ba">AKTIV</span></td></tr>
                  <tr><td><div style="font-weight:600;">Voice Agent</div><div class="tmn">ğŸ“ VAPI</div></td><td class="tmn">Eiendom Nord</td><td class="tmn" id="aa2">58</td><td style="color:var(--b1);font-family:'DM Mono',monospace;font-size:11px;">91%</td><td><span class="bge ba">AKTIV</span></td></tr>
                  <tr><td><div style="font-weight:600;">Lead Capture</div><div class="tmn">ğŸ¯ Email Â· CRM</div></td><td class="tmn">Regnskap AS</td><td class="tmn" id="aa3">777</td><td style="color:var(--o);font-family:'DM Mono',monospace;font-size:11px;">88%</td><td><span class="bge ba">AKTIV</span></td></tr>
                  <tr><td><div style="font-weight:600;">Enterprise Bot</div><div class="tmn">âš¡ Multi-kanal</div></td><td class="tmn">Tech Solutions</td><td class="tmn" id="aa4">1 842</td><td style="color:var(--au);font-family:'DM Mono',monospace;font-size:11px;">97%</td><td><span class="bge ba">AKTIV</span></td></tr>
                </tbody>
              </table></div>
            </div>
            <div class="g3" style="margin-bottom:0;">
              <div class="card" style="padding:15px 16px;"><div class="slbl">Email i dag</div><div style="font-family:'Instrument Sans',sans-serif;font-weight:600;font-size:19px;margin-bottom:9px;" id="adb-em">412</div><div class="mc" id="adb-emc"></div></div>
              <div class="card" style="padding:15px 16px;"><div class="slbl">Voice i dag</div><div style="font-family:'Instrument Sans',sans-serif;font-weight:600;font-size:19px;margin-bottom:9px;" id="adb-vo">58</div><div class="mc" id="adb-vmc"></div></div>
              <div class="card" style="padding:15px 16px;"><div class="slbl">Leads i dag</div><div style="font-family:'Instrument Sans',sans-serif;font-weight:600;font-size:19px;margin-bottom:9px;" id="adb-lc">47</div><div class="mc" id="adb-lmc"></div></div>
            </div>
          </div>
          <div class="col">
            <div class="card">
              <div class="ch"><div class="ct"><span class="ld"></span> Live aktivitet</div></div>
              <div id="a-feed"></div>
            </div>
            <div class="card" style="padding:16px 18px;">
              <div style="font-family:'Instrument Sans',sans-serif;font-weight:700;font-size:13px;margin-bottom:12px;">Total ROI denne mÃ¥neden</div>
              <div style="display:flex;flex-direction:column;gap:7px;font-size:12.5px;">
                <div style="display:flex;justify-content:space-between;"><span style="color:var(--mu);">Spart tid (alle klienter)</span><span id="roi-h" style="font-family:'DM Mono',monospace;">â€”</span></div>
                <div style="display:flex;justify-content:space-between;"><span style="color:var(--mu);">Estimert lÃ¸nnskost spart</span><span id="roi-s" style="font-family:'DM Mono',monospace;color:var(--g);">â€”</span></div>
                <div style="display:flex;justify-content:space-between;"><span style="color:var(--mu);">SCS inntekt (MRR)</span><span id="roi-mrr" style="font-family:'DM Mono',monospace;color:var(--g);">â€”</span></div>
                <div style="height:1px;background:var(--b);"></div>
                <div style="display:flex;justify-content:space-between;"><span style="font-weight:700;">Klient netto besparelse</span><span style="font-family:'Instrument Sans',sans-serif;font-weight:600;font-size:17px;color:var(--g);" id="roi-n">â€”</span></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- â”€â”€ AVTALER & ROI â”€â”€ -->
    <section class="pg" id="pg-a-tiers">
      <div class="atb"><div class="apt">ğŸ“Š Avtaler & ROI</div><span class="tr-badge tr-g"><span class="ld"></span> Live</span></div>
      <div class="ac">
        <div class="g4" style="margin-bottom:18px;">
          <div class="sc" style="--ca:var(--g)"><div class="slbl">Total MRR</div><div class="sval" id="av-mrr">â€”</div><div class="schg sup">â†‘ per mnd</div></div>
          <div class="sc" style="--ca:var(--b1)"><div class="slbl">Samlet klientbesparelse</div><div class="sval" id="av-besparing">â€”</div><div class="schg sup">kr/mnd</div></div>
          <div class="sc" style="--ca:var(--au)"><div class="slbl">Snitt ROI</div><div class="sval" id="av-roi">â€”</div><div class="schg smt">per klient</div></div>
          <div class="sc" style="--ca:var(--o)"><div class="slbl">Aktive avtaler</div><div class="sval" id="av-antall">â€”</div><div class="schg smt">klienter</div></div>
        </div>
        <div class="card">
          <div class="ch">
            <div class="ct">Alle avtaler</div>
            <div style="font-size:11px;color:var(--mu);font-family:'DM Mono',monospace;">sortert etter besparelse</div>
          </div>
          <div class="tw">
            <table>
              <thead><tr><th>Klient</th><th>StÃ¸rrelse</th><th>Agenter</th><th>Avtale/mnd</th><th>Kunden sparer/mnd</th><th>ROI</th><th>Netto til kunden</th><th>Status</th></tr></thead>
              <tbody id="av-tbody"></tbody>
            </table>
          </div>
        </div>
        <div class="card" style="margin-top:14px;">
          <div class="ch"><div class="ct">Intern kapasitetsveiledning</div><div style="font-size:11px;color:var(--mu);font-family:'DM Mono',monospace;">brukes ikke mot kunden</div></div>
          <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;padding:0 18px 18px;">
            <div style="background:var(--t1b);border:1px solid var(--t1e);border-radius:10px;padding:14px;">
              <div style="font-family:'DM Mono',monospace;font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--t1);margin-bottom:8px;">âš¡ Liten</div>
              <div style="font-size:12.5px;color:var(--m2);">Opptil 5 agenter</div>
              <div style="font-size:11px;color:var(--mu);margin-top:5px;">Typisk avtale: 5 000â€“15 000 kr/mnd avhengig av ROI</div>
            </div>
            <div style="background:var(--t2b);border:1px solid var(--t2e);border-radius:10px;padding:14px;">
              <div style="font-family:'DM Mono',monospace;font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--t2);margin-bottom:8px;">ğŸš€ Medium</div>
              <div style="font-size:12.5px;color:var(--m2);">Opptil 15 agenter</div>
              <div style="font-size:11px;color:var(--mu);margin-top:5px;">Typisk avtale: 12 000â€“30 000 kr/mnd avhengig av ROI</div>
            </div>
            <div style="background:var(--t3b);border:1px solid var(--t3e);border-radius:10px;padding:14px;">
              <div style="font-family:'DM Mono',monospace;font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--t3);margin-bottom:8px;">ğŸ† Stor</div>
              <div style="font-size:12.5px;color:var(--m2);">50+ agenter</div>
              <div style="font-size:11px;color:var(--mu);margin-top:5px;">Typisk avtale: 25 000â€“80 000+ kr/mnd avhengig av ROI</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- â”€â”€ KLIENTER â”€â”€ -->
    <section class="pg" id="pg-a-kl">
      <div class="atb">
        <div class="apt">ğŸ‘¥ Klienter <span class="bge ba" style="font-size:10px;padding:3px 9px;margin-left:6px;">ğŸ”’ ADMIN</span></div>
        <div style="display:flex;gap:8px;align-items:center;">
          <span class="tr-badge tr-g"><span class="ld"></span> Live</span>
          <button class="btn btn-g btn-sm" id="btn-newcl">+ Ny klient</button>
        </div>
      </div>
      <div class="ac">
        <div class="g4">
          <div class="sc" style="--ca:var(--g)"><div class="slbl">Totale klienter</div><div class="sval" id="kl-tot">12</div><div class="schg sup">â†‘ aktive</div></div>
          <div class="sc" style="--ca:var(--au)"><div class="slbl">MRR</div><div class="sval" id="kl-mrr">â€”</div><div class="schg sup">kr</div></div>
          <div class="sc" style="--ca:var(--b1)"><div class="slbl">Aktive agenter</div><div class="sval" id="kl-ag">â€”</div><div class="schg sup">live</div></div>
          <div class="sc" style="--ca:var(--er)"><div class="slbl">Maxet kapasitet</div><div class="sval" id="kl-max">1</div><div class="schg" style="color:var(--wa);">trenger oppgradering</div></div>
        </div>
        <div class="card">
          <div class="ch">
            <div class="ct">Klient-oversikt</div>
            <div style="display:flex;gap:8px;">
              <div style="display:flex;align-items:center;gap:7px;background:var(--s2);border:1px solid var(--b2);border-radius:7px;padding:6px 11px;">
                <span style="color:var(--mu);">ğŸ”</span>
                <input id="cl-search" placeholder="SÃ¸k..." style="background:none;border:none;outline:none;font-size:12.5px;color:var(--tx);font-family:'Instrument Sans',sans-serif;width:130px;">
              </div>
              <select id="cl-tier-filter" class="fgs" style="width:auto;padding:6px 11px;font-size:12px;">
                <option value="">Alle stÃ¸rrelser</option>
                <option value="1">Liten (â‰¤5 agenter)</option>
                <option value="2">Medium (â‰¤15)</option>
                <option value="3">Stor (50+)</option>
              </select>
            </div>
          </div>
          <div class="tw"><table>
            <thead><tr><th>Klient</th><th>StÃ¸rrelse</th><th>Agenter</th><th>Handlinger i dag</th><th>Avtale/mnd</th><th>Kunden sparer/mnd</th><th>ROI</th><th>Status</th><th></th></tr></thead>
            <tbody id="cl-tbody"></tbody>
          </table></div>
        </div>
      </div>
    </section>

    <!-- â”€â”€ FAKTURERING â”€â”€ -->
    <section class="pg" id="pg-a-fak">
      <div class="atb"><div class="apt">ğŸ’³ Fakturering <span class="bge ba" style="font-size:10px;margin-left:6px;">ğŸ”’ ADMIN</span></div></div>
      <div class="ac">
        <div class="g3">
          <div class="sc" style="--ca:var(--au)"><div class="slbl">MRR</div><div class="sval" id="fak-mrr">â€”</div><div class="schg sup">kr/mnd</div></div>
          <div class="sc" style="--ca:var(--g)"><div class="slbl">ARR</div><div class="sval" id="fak-arr">â€”</div><div class="schg sup">kr/Ã¥r</div></div>
          <div class="sc" style="--ca:var(--b1)"><div class="slbl">Betalingstatus</div><div class="sval">11/12</div><div class="schg" style="color:var(--wa);">1 venter</div></div>
        </div>
        <div class="card">
          <div class="ch"><div class="ct">Fakturaer februar 2026</div></div>
          <div class="tw"><table><thead><tr><th>Klient</th><th>Avtale/mnd</th><th>Kunden sparer</th><th>Forfall</th><th>Status</th></tr></thead>
          <tbody id="fak-tbody"></tbody>
          </table></div>
        </div>
      </div>
    </section>

    <!-- â”€â”€ AGENTER â”€â”€ -->
    <section class="pg" id="pg-a-ag">
      <div class="atb"><div class="apt">ğŸ¤– Agenter</div><div style="display:flex;gap:8px;"><span class="tr-badge tr-g"><span class="ld"></span> Live</span><button class="btn btn-g btn-sm" data-goto="a-ny">+ Ny agent</button></div></div>
      <div class="ac">
        <div class="g2" style="margin-bottom:13px;">
          <div class="card" style="padding:15px 17px;"><div class="slbl">Total portefÃ¸lje</div><div style="font-family:'Instrument Sans',sans-serif;font-weight:700;font-size:22px;color:var(--g);margin-top:6px;" id="adm-tot-besparing">â€”</div><div style="font-size:10.5px;color:var(--mu);font-family:'DM Mono',monospace;margin-top:4px;">samlet klientbesparelse/mnd</div></div>
          <div class="card" style="padding:15px 17px;"><div class="slbl">Totale handlinger i dag</div><div style="font-family:'Instrument Sans',sans-serif;font-weight:600;font-size:20px;margin-top:6px;" id="ag-tot">â€”</div><div style="font-size:11px;color:var(--g);font-family:'DM Mono',monospace;margin-top:3px;">â†‘ sanntid</div></div>
        </div>
        <div class="g2" id="ag-cards"></div>
      </div>
    </section>

    <!-- â”€â”€ NY AGENT â”€â”€ -->
    <section class="pg" id="pg-a-ny">
      <div class="atb"><div class="apt">âœ¨ Ny agent</div><button class="btn btn-gh btn-sm" data-goto="a-ag">â† Tilbake</button></div>
      <div class="ac" style="max-width:680px;">
        <div class="card">
          <div class="ch"><div class="ct">Opprett AI-agent</div></div>
          <div style="padding:20px;">
            <div class="fg2">
              <div class="fg1"><label class="fgl">Agent-navn *</label><input class="fgi" id="ny-nm" placeholder="f.eks. Email Support â€” Regnskap AS"></div>
              <div class="fg1"><label class="fgl">Tilordne klient</label>
                <select class="fgs" id="ny-klient">
                  <option value="">Velg klient...</option>
                </select>
              </div>
            </div>
            <div class="fg2">
              <div class="fg1"><label class="fgl">Kanaltype</label><select class="fgs" id="ny-kanal"><option>ğŸ“¬ Email</option><option>ğŸ“ Voice</option><option>ğŸ¯ Lead Capture</option><option>ğŸ“„ Dokument</option></select></div>
              <div class="fg1"><label class="fgl">Tone</label><select class="fgs"><option>Profesjonell</option><option>Vennlig</option><option>Salgsrettet</option><option>Empatisk</option></select></div>
            </div>
            <div style="display:flex;justify-content:flex-end;margin-top:8px;"><button class="btn btn-g" id="btn-opprett-agent">âš¡ Aktiver agent</button></div>
          </div>
        </div>
      </div>
    </section>

    <!-- â”€â”€ INTEGRASJONER â”€â”€ -->
    <section class="pg" id="pg-a-int">
      <div class="atb"><div class="apt">ğŸ”— Integrasjoner</div></div>
      <div class="ac">
        <div style="display:flex;flex-direction:column;gap:10px;">
          <div class="card" style="padding:15px 18px;display:flex;align-items:center;gap:14px;"><div style="width:42px;height:42px;background:#EA4335;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px;">ğŸ“§</div><div style="flex:1;"><div style="font-weight:700;">Gmail</div><div class="tmn">noreply@simplycomplex.no Â· synk. nÃ¥</div></div><span class="bge ba">TILKOBLET</span></div>
          <div class="card" style="padding:15px 18px;display:flex;align-items:center;gap:14px;"><div style="width:42px;height:42px;background:#FF7A59;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px;">ğŸ¢</div><div style="flex:1;"><div style="font-weight:700;">HubSpot CRM</div><div class="tmn">1 342 kontakter synkronisert</div></div><span class="bge ba">TILKOBLET</span></div>
          <div class="card" style="padding:15px 18px;display:flex;align-items:center;gap:14px;"><div style="width:42px;height:42px;background:#6B47ED;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px;">ğŸ“</div><div style="flex:1;"><div style="font-weight:700;">VAPI Voice AI</div><div class="tmn">+47 22 33 44 55 Â· aktiv</div></div><span class="bge ba">TILKOBLET</span></div>
          <div class="card" style="padding:15px 18px;display:flex;align-items:center;gap:14px;opacity:0.6;"><div style="width:42px;height:42px;background:#4A154B;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px;">ğŸ’¬</div><div style="flex:1;"><div style="font-weight:700;">Slack</div><div class="tmn">Varsler til Slack-kanal</div></div><span class="bge bd">IKKE KOBLET</span><button class="btn btn-g btn-sm int-koble-btn">Koble til</button></div>
        </div>
      </div>
    </section>

    <!-- â”€â”€ EMAIL â”€â”€ -->
    <section class="pg" id="pg-a-email">
      <div class="atb"><div class="apt">ğŸ“¬ Email</div><span class="bge ba" style="padding:5px 12px;">â— AKTIV</span></div>
      <div class="ac">
        <div class="gms">
          <div class="card"><div class="ch"><div class="ct">Email-agent konfigurasjon</div></div><div style="padding:18px;"><div class="fg2"><div class="fg1"><label class="fgl">Svar fra</label><input class="fgi" value="Sofia â€” SCS Support"></div><div class="fg1"><label class="fgl">Svar-email</label><input class="fgi" value="sofia@client.no"></div></div><div class="fg1"><label class="fgl">Signatur</label><textarea class="fgt" style="min-height:55px;">Med vennlig hilsen, Sofia</textarea></div><button class="btn btn-g btn-sm" id="btn-save-email">Lagre</button></div></div>
          <div class="col">
            <div class="g2" style="margin-bottom:0;"><div class="sc" style="--ca:var(--g)"><div class="slbl">I dag</div><div class="sval" id="em-td">412</div></div><div class="sc" style="--ca:var(--b1)"><div class="slbl">Suksessrate</div><div class="sval">96%</div></div></div>
            <div class="card" style="padding:15px 17px;"><div class="trow"><div><div class="tlbl">Spam-filter</div></div><label class="tog"><input type="checkbox" checked><span class="ts"></span></label></div><div class="trow"><div><div class="tlbl">Auto-oppfÃ¸lging</div></div><label class="tog"><input type="checkbox" checked><span class="ts"></span></label></div></div>
          </div>
        </div>
      </div>
    </section>

    <!-- â”€â”€ VOICE â”€â”€ -->
    <section class="pg" id="pg-a-voice">
      <div class="atb"><div class="apt">ğŸ“ Voice</div><span class="bge ba" style="padding:5px 12px;">â— AKTIV</span></div>
      <div class="ac">
        <div class="gms">
          <div class="card"><div class="ch"><div class="ct">Voice-agent konfigurasjon</div></div><div style="padding:18px;"><div class="fg2"><div class="fg1"><label class="fgl">Nummer</label><input class="fgi" value="+47 22 33 44 55" readonly style="background:var(--s3);color:var(--m2);"></div><div class="fg1"><label class="fgl">Stemme</label><select class="fgs"><option>Sofia (norsk, F)</option><option>Ola (norsk, M)</option></select></div></div><div class="fg1"><label class="fgl">Ã…pningshilsen</label><textarea class="fgt" style="min-height:55px;">Hei! Du har ringt Regnskap AS. Jeg er Sofia.</textarea></div><button class="btn btn-g btn-sm" id="btn-save-voice">Lagre</button></div></div>
          <div class="col">
            <div class="g2" style="margin-bottom:0;"><div class="sc" style="--ca:var(--b1)"><div class="slbl">Samtaler i dag</div><div class="sval" id="vo-td">58</div></div><div class="sc" style="--ca:var(--g)"><div class="slbl">Snitt varighet</div><div class="sval">3.4m</div></div></div>
            <div class="card" style="padding:16px;text-align:center;"><div class="vviz" style="justify-content:center;margin-bottom:8px;"><div class="vbar" style="animation-delay:0s;"></div><div class="vbar" style="animation-delay:0.15s;"></div><div class="vbar" style="animation-delay:0.3s;"></div><div class="vbar" style="animation-delay:0.45s;"></div><div class="vbar" style="animation-delay:0.6s;"></div><div class="vbar" style="animation-delay:0.75s;"></div></div><div class="tmn">Ingen aktiv samtale</div></div>
          </div>
        </div>
      </div>
    </section>

    <!-- â”€â”€ CRM â”€â”€ -->
    <section class="pg" id="pg-a-crm">
      <div class="atb"><div class="apt">ğŸ¢ CRM</div><span class="tr-badge tr-g"><span class="ld"></span> Live</span></div>
      <div class="ac">
        <div class="g4">
          <div class="sc" style="--ca:var(--g)"><div class="slbl">Kontakter</div><div class="sval" id="crm-c">1 342</div><div class="schg sup">â†‘ live</div></div>
          <div class="sc" style="--ca:var(--o)"><div class="slbl">Leads</div><div class="sval" id="crm-l">162</div><div class="schg sup">â†‘ live</div></div>
          <div class="sc" style="--ca:var(--b1)"><div class="slbl">Konvertert</div><div class="sval">54</div><div class="schg smt">33% rate</div></div>
          <div class="sc" style="--ca:var(--pu)"><div class="slbl">Avg. score</div><div class="sval" id="crm-s">7.6</div><div class="schg sup">â†‘ live</div></div>
        </div>
      </div>
    </section>

    <!-- â”€â”€ API KOSTNADER â”€â”€ -->
    <section class="pg" id="pg-a-api">
      <div class="atb"><div class="apt">ğŸ’¸ API-kostnader</div><span class="tr-badge tr-g"><span class="ld"></span> Live</span></div>
      <div class="ac">
        <div class="g4" style="margin-bottom:18px;">
          <div class="sc" style="--ca:var(--b1)"><div class="slbl">Total API-kost/mnd</div><div class="sval" id="api-tot">â€”</div><div class="schg smt">alle klienter</div></div>
          <div class="sc" style="--ca:var(--er)"><div class="slbl">Over grense</div><div class="sval" id="api-over">â€”</div><div class="schg smt">klienter</div></div>
          <div class="sc" style="--ca:var(--wa)"><div class="slbl">NÃ¦r grense</div><div class="sval" id="api-warn">â€”</div><div class="schg smt">klienter</div></div>
          <div class="sc" style="--ca:var(--g)"><div class="slbl">Snitt API-kost</div><div class="sval" id="api-avg">â€”</div><div class="schg smt">per klient</div></div>
        </div>
        <div style="background:rgba(47,139,255,.06);border:1px solid rgba(47,139,255,.15);border-radius:11px;padding:14px 18px;margin-bottom:18px;font-size:12.5px;color:var(--m2);line-height:1.7;">
          <span style="color:var(--b1);font-weight:700;">â„¹ï¸ Slik fungerer det:</span> Kunden eier og betaler sine egne API-nÃ¸kler (OpenAI, VAPI osv.) direkte. SCS holder oversikt pÃ¥ estimert forbruk per klient basert pÃ¥ agentaktivitet.
        </div>
        <div class="card">
          <div class="ch">
            <div class="ct">API-forbruk per klient</div>
            <div style="display:flex;gap:8px;align-items:center;">
              <span class="tmn">denne mÃ¥neden</span>
              <button class="btn btn-gh btn-sm" id="btn-export-api">ğŸ“Š Eksporter</button>
            </div>
          </div>
          <div class="tw"><table>
            <thead><tr><th>Klient</th><th>Agenter</th><th>API-kost/mnd</th><th>Grense</th><th>Utnyttelse</th><th>Status</th><th></th></tr></thead>
            <tbody id="api-tbody"></tbody>
          </table></div>
        </div>
        <div class="card" style="margin-top:14px;">
          <div class="ch"><div class="ct">âš ï¸ Aktive varsler</div></div>
          <div id="api-varsler" style="padding:0 18px 18px;display:flex;flex-direction:column;gap:9px;"></div>
        </div>
      </div>
    </section>

    <!-- â”€â”€ BRUKERE â”€â”€ -->
    <section class="pg" id="pg-a-usr">
      <div class="atb"><div class="apt">ğŸ”‘ Brukere & tilgang <span class="bge ba" style="font-size:10px;margin-left:6px;">ğŸ”’ ADMIN</span></div>
        <button class="btn btn-g btn-sm" id="btn-invuser">+ Inviter bruker</button>
      </div>
      <div class="ac">
        <div class="card">
          <div class="ch"><div class="ct">Brukere med tilgang</div></div>
          <div class="tw"><table><thead><tr><th>Bruker</th><th>Rolle</th><th>Kan se</th><th>Siste innlogging</th><th></th></tr></thead>
          <tbody id="usr-tbody"></tbody>
          </table></div>
        </div>
        <div class="card" style="margin-top:13px;padding:18px;">
          <div style="font-family:'Instrument Sans',sans-serif;font-weight:700;font-size:13px;margin-bottom:11px;">Tilgangssystem</div>
          <div style="display:flex;flex-direction:column;gap:9px;">
            <div style="display:flex;align-items:center;gap:12px;padding:10px 13px;background:rgba(0,229,160,0.05);border:1px solid var(--t1e);border-radius:9px;"><span class="bge ba">SCS ADMIN</span><span style="font-size:12.5px;color:var(--m2);">Full tilgang â€” klienter, avtaler, fakturering, brukere, systemlogg</span></div>
            <div style="display:flex;align-items:center;gap:12px;padding:10px 13px;background:rgba(47,139,255,0.05);border:1px solid var(--t2e);border-radius:9px;"><span class="bge bt2">KLIENT</span><span style="font-size:12.5px;color:var(--m2);">Kun eget klient-dashboard â€” ingen tilgang til andre klienter eller admindata</span></div>
          </div>
        </div>
      </div>
    </section>

    <!-- â”€â”€ LOGG â”€â”€ -->
    <section class="pg" id="pg-a-log">
      <div class="atb"><div class="apt">ğŸ“‹ Systemlogg</div><span class="tr-badge tr-g"><span class="ld"></span> Live</span></div>
      <div class="ac">
        <div class="g4" style="margin-bottom:16px;">
          <div class="sc" style="--ca:var(--g)"><div class="slbl">OK</div><div class="sval" id="lg-ok">2 658</div></div>
          <div class="sc" style="--ca:var(--b1)"><div class="slbl">Info</div><div class="sval" id="lg-in">184</div></div>
          <div class="sc" style="--ca:var(--wa)"><div class="slbl">Advarsel</div><div class="sval" id="lg-wa">5</div></div>
          <div class="sc" style="--ca:var(--er)"><div class="slbl">Feil</div><div class="sval" id="lg-er">0</div></div>
        </div>
        <div class="card"><div class="ch"><div class="ct"><span class="ld"></span> Live logg</div></div><div id="log-feed"></div></div>
      </div>
    </section>

    <!-- â”€â”€ INNSTILLINGER â”€â”€ -->
    <section class="pg" id="pg-a-set">
      <div class="atb"><div class="apt">âš™ï¸ Innstillinger</div><button class="btn btn-g btn-sm" id="btn-save-settings">Lagre alt</button></div>
      <div class="ac">
        <div style="background:linear-gradient(135deg,rgba(0,229,160,0.05),rgba(47,139,255,0.05));border:1.5px solid rgba(0,229,160,0.18);border-radius:14px;padding:22px;margin-bottom:18px;">
          <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px;">
            <div style="width:40px;height:40px;border-radius:10px;background:rgba(0,229,160,0.1);display:flex;align-items:center;justify-content:center;font-size:20px;">ğŸ”Œ</div>
            <div style="flex:1;">
              <div style="font-family:'Instrument Sans',sans-serif;font-weight:700;font-size:14.5px;">Supabase Live-tilkobling</div>
              <div style="font-size:12px;color:var(--m2);margin-top:2px;">Koble til din database â€” dashboardet viser ekte tall fra n8n</div>
            </div>
            <div id="set-conn-badge"><span class="tmn">â— Ikke tilkoblet</span></div>
          </div>
          <div class="fg2">
            <div class="fg1"><label class="fgl">Supabase Project URL</label><input class="fgi" id="sb-url" placeholder="https://xxxxxxxxxxxx.supabase.co"></div>
            <div class="fg1"><label class="fgl">Anon Key (public)</label><input class="fgi" id="sb-key" placeholder="eyJhbGciOiJIUzI1NiIs..." type="password"><div class="tmn" style="margin-top:3px;">Supabase â†’ Project Settings â†’ API â†’ anon public</div></div>
          </div>
          <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
            <button class="btn btn-g btn-sm" id="btn-test-sb">âš¡ Test tilkobling</button>
            <button class="btn btn-gh btn-sm" id="btn-open-sb">Ã…pne Supabase â†—</button>
            <button class="btn btn-gh btn-sm" id="btn-open-n8n">Ã…pne n8n â†—</button>
            <span id="sb-test-msg" class="tmn"></span>
          </div>
          <div style="margin-top:16px;padding-top:14px;border-top:1px solid rgba(0,229,160,0.1);">
            <div class="tmn" style="margin-bottom:7px;text-transform:uppercase;letter-spacing:1px;">n8n Webhook URL</div>
            <div style="display:flex;align-items:center;gap:9px;background:var(--bg);border:1px solid var(--b2);border-radius:8px;padding:10px 13px;">
              <code style="font-family:'DM Mono',monospace;font-size:11.5px;color:var(--g);flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;" id="webhook-url">https://din-n8n.app.n8n.cloud/webhook/scs-agent-log</code>
              <button class="btn btn-gh btn-sm" id="btn-copy-webhook">ğŸ“‹ Kopier</button>
            </div>
          </div>
        </div>
        <div class="gms">
          <div class="col">
            <div class="card"><div class="ch"><div class="ct">Konto</div></div><div style="padding:18px;"><div class="fg2"><div class="fg1"><label class="fgl">Org. navn</label><input class="fgi" value="Simply Complex Solutions AS"></div><div class="fg1"><label class="fgl">Org. nr.</label><input class="fgi" value="924 182 XXX"></div></div><div class="fg1"><label class="fgl">Admin-email</label><input class="fgi" value="admin@simplycomplex.no"></div></div></div>
            <div class="card"><div class="ch"><div class="ct">Varsler</div></div><div style="padding:18px;"><div class="trow"><div><div class="tlbl">Daglig rapport</div></div><label class="tog"><input type="checkbox" checked><span class="ts"></span></label></div><div class="trow"><div><div class="tlbl">Klient-eskalering</div></div><label class="tog"><input type="checkbox" checked><span class="ts"></span></label></div><div class="trow"><div><div class="tlbl">ROI-varsler</div></div><label class="tog"><input type="checkbox" checked><span class="ts"></span></label></div></div></div>
            <div class="card"><div class="ch"><div class="ct">GDPR & AI Act art. 4</div><span class="tag tw2">PÃ¥krevd</span></div><div style="padding:18px;"><div class="trow"><div><div class="tlbl">AI-opplysning til kunder</div></div><label class="tog"><input type="checkbox" checked><span class="ts"></span></label></div><div class="trow"><div><div class="tlbl">Datalagring i Norge</div></div><label class="tog"><input type="checkbox" checked><span class="ts"></span></label></div></div></div>
          </div>
          <div class="col">
            <div class="card" style="padding:18px;"><div style="font-family:'Instrument Sans',sans-serif;font-weight:700;font-size:13px;margin-bottom:12px;">SCS portefÃ¸lje</div><div style="background:rgba(0,229,160,.06);border:1px solid rgba(0,229,160,.2);border-radius:9px;padding:14px;"><div class="slbl">MRR</div><div style="font-family:'Instrument Sans',sans-serif;font-weight:700;font-size:18px;color:var(--g);" id="adm-mrr-set">â€”</div><div style="font-size:11px;color:var(--m2);margin-top:4px;">Snitt ROI per klient: <span style="color:var(--g);font-weight:700;" id="adm-avg-roi-set">â€”</span></div></div><button class="btn btn-gh" style="width:100%;margin-top:10px;" data-goto="a-tiers">Se alle avtaler â†’</button></div>
            <div class="card" style="padding:18px;"><div style="font-family:'Instrument Sans',sans-serif;font-weight:700;font-size:13px;margin-bottom:12px;color:var(--er);">Farlig sone</div><div style="display:flex;flex-direction:column;gap:7px;"><button class="btn btn-er" style="width:100%;text-align:left;" id="btn-pause-alle">â¸ Pause alle agenter</button></div></div>
          </div>
        </div>
      </div>
    </section>

  </main>
</div><!-- /v-admin -->


<!-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     â•‘  CLIENT APP
     â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="v-client">
  <div class="c-topstrip"></div>
  <div class="ctb">
    <div style="display:flex;align-items:center;gap:16px;">
      <div class="c-mark">Simply<span>Complex</span></div>
      <div class="c-sep"></div>
      <nav class="cnav">
        <div class="cni on" data-cpage="c-db">Dashboard</div>
        <div class="cni" data-cpage="c-ag">Mine agenter</div>
        <div class="cni" data-cpage="c-akt">Aktivitet</div>
        <div class="cni" data-cpage="c-sup">Support</div>
        <div class="cni" data-cpage="c-api">API-nÃ¸kler</div>
        <div class="cni" data-cpage="c-set">Innstillinger</div>
      </nav>
    </div>
    <div class="ctbr">
      <div class="c-cbadge">
        <span id="c-icon">ğŸ¢</span>
        <span id="c-name">â€”</span>
        <span class="c-tbadge" id="c-tbadge"></span>
      </div>
      <div class="tmn" id="c-clk">--:--:--</div>
      <div class="c-av" id="c-av">â€”</div>
      <button class="btn btn-gh btn-sm" id="c-logout-btn">Logg ut</button>
    </div>
  </div>

  <div class="c-content">

    <!-- â”€â”€ CLIENT DASHBOARD â”€â”€ -->
    <div class="cpg on" id="cpg-c-db">
      <div class="tier-alert" id="c-tier-alert" style="display:none;">
        <div class="ta-icon">âš ï¸</div>
        <div class="ta-text">
          <div class="ta-title">Du har nÃ¥dd maks agenter pÃ¥ din nÃ¥vÃ¦rende plan!</div>
          <div class="ta-desc" id="c-alert-desc">Kontakt SCS for Ã¥ utvide avtalen.</div>
        </div>
        <button class="ta-btn" data-modal="m-upgrade">ğŸ“ Kontakt SCS for oppgradering</button>
      </div>
      <div class="tier-warn" id="c-tier-warn" style="display:none;">
        <div class="tw-icon">ğŸ””</div>
        <div style="flex:1;"><span style="font-weight:700;color:var(--wa);">NÃ¦rmer seg grensen: </span><span id="c-warn-desc" style="color:var(--m2);">â€”</span></div>
        <button class="btn btn-wa btn-sm" data-modal="m-upgrade">Oppgrader</button>
      </div>

      <div style="margin-bottom:20px;">
        <div style="font-family:'Instrument Sans',sans-serif;font-weight:700;font-size:20px;letter-spacing:-0.3px;margin-bottom:3px;">Hei, <span id="c-greet">â€”</span> ğŸ‘‹</div>
        <div style="font-size:13px;color:var(--m2);">Her er sanntidsoversikten over dine AI-agenter.</div>
      </div>

      <!-- ROI hero -->
      <div style="border-radius:14px;padding:16px 20px;margin-bottom:20px;display:grid;grid-template-columns:1fr 1fr 1fr;gap:0;background:rgba(0,229,160,.04);border:1px solid rgba(0,229,160,.15);" id="c-roi-hero">
        <div style="padding-right:20px;border-right:1px solid rgba(255,255,255,.07);">
          <div class="slbl">Du sparer per mnd</div>
          <div style="font-family:'Instrument Sans',sans-serif;font-weight:700;font-size:26px;color:var(--g);letter-spacing:-0.5px;" id="c-hero-besparing">â€”</div>
          <div style="font-size:11px;color:var(--mu);margin-top:3px;">estimert lÃ¸nnskostnadsbesparelse</div>
        </div>
        <div style="padding:0 20px;border-right:1px solid rgba(255,255,255,.07);">
          <div class="slbl">Avtale per mnd</div>
          <div style="font-family:'Instrument Sans',sans-serif;font-weight:700;font-size:26px;color:var(--tx);letter-spacing:-0.5px;" id="c-hero-avtale">â€”</div>
          <div style="font-size:11px;color:var(--mu);margin-top:3px;">betales til SCS</div>
        </div>
        <div style="padding-left:20px;">
          <div class="slbl">Netto gevinst</div>
          <div style="font-family:'Instrument Sans',sans-serif;font-weight:700;font-size:26px;letter-spacing:-0.5px;color:var(--g);" id="c-hero-netto">â€”</div>
          <div id="c-hero-roi" style="font-size:11px;color:var(--mu);margin-top:3px;">ROI: â€”</div>
        </div>
      </div>

      <!-- Stats -->
      <div class="g4" style="margin-bottom:20px;">
        <div class="csc" style="--ca:var(--b1)"><div class="slbl">Aktive agenter</div><div class="sval" id="c-s-ag">â€”</div><div class="schg sup">â†‘ sanntid</div></div>
        <div class="csc" style="--ca:var(--g)"><div class="slbl">Handlinger i dag</div><div class="sval" id="c-s-act">â€”</div><div class="schg sup">â†‘ live</div></div>
        <div class="csc" style="--ca:var(--o)"><div class="slbl">Leads fanget</div><div class="sval" id="c-s-leads">â€”</div><div class="schg sup">â†‘ live</div></div>
        <div class="csc" style="--ca:var(--g)"><div class="slbl">Timer spart (mnd)</div><div class="sval" id="c-s-tid">â€”</div><div class="schg smt">estimert</div></div>
      </div>

      <div style="display:grid;grid-template-columns:1fr 270px;gap:14px;margin-bottom:14px;">
        <div class="ccard">
          <div class="cch"><div class="cct">Dine agenter â€” live</div><span class="tr-badge tr-b"><span class="ld ld-b"></span> Live</span></div>
          <div id="c-aglist"></div>
        </div>
        <div class="ccard">
          <div class="cch"><div class="cct">Siste aktivitet</div></div>
          <div id="c-feed"></div>
        </div>
      </div>

      <!-- ROI breakdown + chart -->
      <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:13px;">
        <div class="ccard" style="padding:17px;">
          <div style="font-family:'Instrument Sans',sans-serif;font-weight:700;font-size:13px;margin-bottom:12px;">Avtaleoversikt</div>
          <div style="display:flex;flex-direction:column;gap:8px;font-size:12.5px;">
            <div style="display:flex;justify-content:space-between;"><span style="color:var(--mu);">Timer spart</span><span id="c-roi-h" style="font-family:'DM Mono',monospace;">â€”</span></div>
            <div style="display:flex;justify-content:space-between;"><span style="color:var(--mu);">Estimert besparelse</span><span id="c-roi-s" style="color:var(--g);font-family:'DM Mono',monospace;">â€”</span></div>
            <div style="display:flex;justify-content:space-between;"><span style="color:var(--mu);">Avtalepris SCS</span><span id="c-plan-cost" style="font-family:'DM Mono',monospace;">â€”</span></div>
            <div style="height:1px;background:rgba(0,229,160,0.1);"></div>
            <div style="display:flex;justify-content:space-between;align-items:center;">
              <span style="font-weight:700;">Din netto gevinst</span>
              <span style="font-family:'Instrument Sans',sans-serif;font-weight:700;font-size:18px;color:var(--g);" id="c-roi-n">â€”</span>
            </div>
            <div style="background:rgba(0,229,160,.07);border-radius:8px;padding:8px 11px;text-align:center;margin-top:2px;">
              <span class="tmn">ROI </span>
              <span style="font-family:'Instrument Sans',sans-serif;font-weight:700;font-size:16px;color:var(--g);" id="c-roi-x">â€”</span>
              <span id="c-roi-pct" class="tmn"> Â· du beholder â€”</span>
            </div>
          </div>
        </div>
        <div class="ccard" style="padding:17px;">
          <div style="font-family:'Instrument Sans',sans-serif;font-weight:700;font-size:13px;margin-bottom:10px;" id="c-ch1-title">Handlinger i dag</div>
          <div style="font-family:'Instrument Sans',sans-serif;font-weight:600;font-size:20px;margin-bottom:9px;" id="c-ch1-val">â€”</div>
          <div class="mc" id="c-chart1"></div>
        </div>
        <div class="ccard" style="padding:17px;">
          <div style="font-family:'Instrument Sans',sans-serif;font-weight:700;font-size:13px;margin-bottom:10px;">Suksessrate (7 dager)</div>
          <div style="font-family:'Instrument Sans',sans-serif;font-weight:600;font-size:20px;margin-bottom:7px;color:var(--g);" id="c-rate">96%</div>
          <div class="pb pb-tall"><div class="pbf" id="c-rateb" style="width:96%;background:var(--b1);"></div></div>
          <div class="tmn" style="margin-top:5px;">Basert pÃ¥ siste 7 dager</div>
        </div>
      </div>
    </div>

    <!-- â”€â”€ MINE AGENTER â”€â”€ -->
    <div class="cpg" id="cpg-c-ag">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;">
        <div><div style="font-family:'Instrument Sans',sans-serif;font-weight:700;font-size:19px;margin-bottom:3px;">Mine agenter</div><div style="font-size:12.5px;color:var(--m2);">Live ytelse for dine AI-agenter</div></div>
        <span class="tr-badge tr-b"><span class="ld ld-b"></span> Sanntid</span>
      </div>
      <div class="tier-alert" id="c-ag-alert" style="display:none;margin-bottom:16px;">
        <div class="ta-icon">ğŸ”’</div>
        <div class="ta-text"><div class="ta-title">Maks agenter nÃ¥dd!</div><div class="ta-desc" id="c-ag-alert-desc">Du kan ikke legge til flere agenter pÃ¥ din nÃ¥vÃ¦rende plan.</div></div>
        <button class="ta-btn" data-modal="m-upgrade">Kontakt SCS â†’</button>
      </div>
      <div class="g2" id="c-agcards"></div>
    </div>

    <!-- â”€â”€ AKTIVITET â”€â”€ -->
    <div class="cpg" id="cpg-c-akt">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;">
        <div><div style="font-family:'Instrument Sans',sans-serif;font-weight:700;font-size:19px;margin-bottom:3px;">Aktivitetslogg</div><div style="font-size:12.5px;color:var(--m2);">Alle automatiserte handlinger fra dine agenter</div></div>
        <span class="tr-badge tr-b"><span class="ld ld-b"></span> Live</span>
      </div>
      <div class="ccard">
        <div class="cch"><div class="cct">Siste handlinger</div></div>
        <div id="c-actlog"></div>
      </div>
    </div>

    <!-- â”€â”€ SUPPORT â”€â”€ -->
    <div class="cpg" id="cpg-c-sup">
      <div style="margin-bottom:18px;"><div style="font-family:'Instrument Sans',sans-serif;font-weight:700;font-size:19px;margin-bottom:3px;">Support</div><div style="font-size:12.5px;color:var(--m2);">Kontakt SCS-teamet direkte</div></div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
        <div class="ccard" style="padding:18px;">
          <div style="font-family:'Instrument Sans',sans-serif;font-weight:700;font-size:13.5px;margin-bottom:14px;">Ny sak til SCS</div>
          <div class="fg1"><label class="fgl">Emne</label><input class="fgi" id="sup-emne" placeholder="Beskriv hva du trenger hjelp med..."></div>
          <div class="fg1"><label class="fgl">Prioritet</label><select class="fgs"><option>Normal</option><option>HÃ¸y</option><option>Kritisk</option></select></div>
          <div class="fg1" style="margin-bottom:14px;"><label class="fgl">Beskrivelse</label><textarea class="fgt" placeholder="Gi oss detaljer..."></textarea></div>
          <button class="btn btn-b" style="width:100%;" id="btn-send-sak">ğŸ“¤ Send sak</button>
        </div>
        <div class="col">
          <div class="ccard" style="padding:16px 18px;">
            <div style="font-family:'Instrument Sans',sans-serif;font-weight:700;font-size:13px;margin-bottom:12px;">Kontakt SCS</div>
            <div style="display:flex;flex-direction:column;gap:10px;font-size:12.5px;">
              <div style="display:flex;gap:11px;align-items:center;"><span style="font-size:16px;">ğŸ“§</span><div><div style="font-weight:600;">Email</div><div style="color:var(--m2);">hei@simplycomplex.no</div></div></div>
              <div style="display:flex;gap:11px;align-items:center;"><span style="font-size:16px;">ğŸ’¬</span><div><div style="font-weight:600;">Chat (Manâ€“Fre 08â€“17)</div><div style="color:var(--m2);">Svartid: &lt;2t</div></div></div>
              <div style="display:flex;gap:11px;align-items:center;"><span style="font-size:16px;">ğŸ“</span><div><div style="font-weight:600;">Telefon</div><div style="color:var(--m2);">+47 22 33 44 55</div></div></div>
            </div>
          </div>
          <div class="ccard" style="padding:16px 18px;" id="c-sup-upgrade">
            <div style="font-family:'Instrument Sans',sans-serif;font-weight:700;font-size:13px;margin-bottom:8px;color:var(--wa);">Vil du utvide avtalen?</div>
            <div style="font-size:12.5px;color:var(--m2);margin-bottom:12px;">Kontakt SCS for Ã¥ legge til flere agenter eller justere avtalen.</div>
            <button class="btn btn-wa" style="width:100%;" data-modal="m-upgrade">ğŸ“ Kontakt SCS</button>
          </div>
          <div class="ccard" style="padding:16px 18px;">
            <div style="font-family:'Instrument Sans',sans-serif;font-weight:700;font-size:13px;margin-bottom:10px;">Ã…pne saker</div>
            <div style="font-size:12.5px;color:var(--m2);text-align:center;padding:18px 0;">Ingen Ã¥pne saker âœ“</div>
          </div>
        </div>
      </div>
    </div>

    <!-- â”€â”€ API-NÃ˜KLER â”€â”€ -->
    <div class="cpg" id="cpg-c-api">
      <div style="margin-bottom:18px;">
        <div style="font-family:'Instrument Sans',sans-serif;font-weight:700;font-size:18px;margin-bottom:3px;">Mine API-nÃ¸kler</div>
        <div style="font-size:12.5px;color:var(--m2);">Du eier og kontrollerer dine egne nÃ¸kler</div>
      </div>

      <div class="ccard" style="margin-bottom:14px;">
        <div class="cch"><div class="cct">ğŸ”‘ API-nÃ¸kler</div></div>
        <div style="padding:16px;display:flex;flex-direction:column;gap:12px;">
          <div style="background:rgba(0,229,160,.04);border:1px solid rgba(0,229,160,.12);border-radius:8px;padding:11px 14px;font-size:11.5px;color:var(--m2);line-height:1.7;">
            <span style="color:var(--g);font-weight:700;">â„¹ï¸ Du eier nÃ¸klene dine.</span> Kostnader belastes direkte av leverandÃ¸rene. SCS bruker dem kun til Ã¥ drive agentene dine.
          </div>
          <div>
            <label class="fgl">ğŸ¤– OpenAI API Key</label>
            <div style="display:flex;gap:7px;">
              <input class="fgi" id="c-key-openai" placeholder="sk-proj-..." style="flex:1;font-family:monospace;font-size:11px;">
              <a href="https://platform.openai.com/api-keys" target="_blank" class="btn btn-gh btn-sm">â†—</a>
            </div>
          </div>
          <div>
            <label class="fgl">ğŸ¢ HubSpot Token <span style="font-weight:400;color:var(--mu);">valgfritt</span></label>
            <div style="display:flex;gap:7px;">
              <input class="fgi" id="c-key-hubspot" placeholder="pat-eu1-..." style="flex:1;font-family:monospace;font-size:11px;">
              <a href="https://app.hubspot.com/private-apps" target="_blank" class="btn btn-gh btn-sm">â†—</a>
            </div>
          </div>
          <div style="border-top:1px solid var(--b2);padding-top:12px;">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;">
              <div style="font-size:12px;font-weight:700;">ğŸ“ Voice-leverandÃ¸r</div>
              <span class="bge ba" style="font-size:9px;">VALGT AV SCS</span>
            </div>
            <div style="background:var(--s3);border-radius:9px;padding:12px 14px;margin-bottom:10px;">
              <div style="font-weight:600;font-size:13px;margin-bottom:4px;" id="c-voice-provider-name">ğŸ“ VAPI</div>
              <div style="font-size:11.5px;color:var(--m2);" id="c-voice-provider-desc">Alt-i-ett voice AI-platform. Enkel oppsett, betaler per minutt.</div>
              <div style="font-size:11px;color:var(--mu);margin-top:6px;">Ã˜nsker du Ã¥ bytte? Kontakt SCS.</div>
            </div>
            <div id="c-voice-key-fields"></div>
            <input type="hidden" id="c-key-sendgrid" value="">
            <input type="hidden" id="c-key-supabase" value="">
          </div>
          <div>
            <label class="fgl">ğŸ”— n8n Instans URL <span style="font-weight:400;color:var(--mu);">valgfritt</span></label>
            <input class="fgi" id="c-n8n-url" placeholder="https://din-n8n.app.n8n.cloud" style="width:100%;font-family:monospace;font-size:11px;">
          </div>
          <button class="btn btn-g btn-sm" id="btn-lagre-api-setup">ğŸ’¾ Lagre nÃ¸kler</button>
        </div>
      </div>

      <div class="ccard" style="margin-bottom:14px;">
        <div class="cch"><div class="cct">ğŸ”— n8n Webhook</div></div>
        <div style="padding:16px;">
          <div style="background:rgba(47,139,255,.05);border:1px solid rgba(47,139,255,.15);border-radius:8px;padding:9px 12px;font-size:11.5px;color:var(--m2);margin-bottom:13px;"><span style="color:var(--b1);font-weight:700;">â„¹ï¸</span> Finn URL-en i n8n under ditt SCS-workflow. SCS setter den opp for deg.</div>
          <label class="fgl">Webhook URL</label>
          <div style="display:flex;gap:7px;margin-bottom:11px;">
            <input class="fgi" id="c-webhook-url" placeholder="https://din-n8n.app.n8n.cloud/webhook/..." style="flex:1;font-family:monospace;font-size:11px;">
            <button class="btn btn-gh btn-sm" id="c-webhook-copy">ğŸ“‹</button>
          </div>
          <a href="https://app.n8n.cloud" target="_blank" class="btn btn-gh btn-sm">Ã…pne n8n â†—</a>
        </div>
      </div>

      <div class="ccard">
        <div class="cch" style="display:flex;align-items:center;justify-content:space-between;">
          <div class="cct">ğŸ¤– Agent-oppfÃ¸rsel</div>
          <span style="font-size:11.5px;color:var(--mu);">Kunnskap og innspill per agent</span>
        </div>
        <div id="c-agent-config-list" style="padding:0 16px 16px;display:flex;flex-direction:column;gap:14px;margin-top:4px;"></div>
      </div>
    </div>

    <!-- â”€â”€ INNSTILLINGER (client) â”€â”€ -->
    <div class="cpg" id="cpg-c-set">
      <div style="margin-bottom:18px;"><div style="font-family:'Instrument Sans',sans-serif;font-weight:700;font-size:19px;margin-bottom:3px;">Innstillinger</div><div style="font-size:12.5px;color:var(--m2);">Administrer din SCS-konto</div></div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
        <div class="ccard"><div class="cch"><div class="cct">Kontaktinformasjon</div></div><div style="padding:18px;"><div class="fg1"><label class="fgl">Selskapsnavn</label><input class="fgi" id="c-set-co"></div><div class="fg1"><label class="fgl">Kontaktperson</label><input class="fgi" id="c-set-cp"></div><div class="fg1" style="margin-bottom:14px;"><label class="fgl">Email (skrivebeskyttet)</label><input class="fgi" id="c-set-em" readonly style="background:var(--s3);color:var(--m2);"></div><button class="btn btn-b btn-sm" id="btn-lagre-klient-set">Lagre</button></div></div>
        <div class="ccard"><div class="cch"><div class="cct">Varsler</div></div><div style="padding:18px;"><div class="trow"><div><div class="tlbl">Daglig rapport</div></div><label class="tog"><input type="checkbox" checked><span class="ts"></span></label></div><div class="trow"><div><div class="tlbl">Eskalerings-varsler</div></div><label class="tog"><input type="checkbox" checked><span class="ts"></span></label></div><div class="trow"><div><div class="tlbl">Ukentlig sammendrag</div></div><label class="tog"><input type="checkbox" checked><span class="ts"></span></label></div></div></div>
      </div>
      <div class="ccard" style="margin-top:13px;padding:16px 18px;display:flex;align-items:center;justify-content:space-between;">
        <div><div style="font-weight:700;margin-bottom:3px;">Din avtale med SCS</div><div style="font-size:12px;color:var(--m2);">Ta kontakt med oss for Ã¥ justere avtalen.</div></div>
        <button class="btn btn-gh btn-sm" data-cpage="c-sup">Kontakt SCS â†’</button>
      </div>
    </div>

  </div><!-- /c-content -->
</div><!-- /v-client -->


<!-- â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” MODALS â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” -->

<!-- NY KLIENT -->
<div class="mo" id="m-newcl">
  <div class="mbox" style="width:min(560px,94vw);">
    <div class="mhd"><div class="mti">ğŸ¢ Ny klient</div><button class="mcl mo-close">âœ•</button></div>
    <div class="mbd" style="padding-bottom:6px;">
      <div class="slbl" style="margin-bottom:10px;">Selskapsinformasjon</div>
      <div class="fg2" style="margin-bottom:0;">
        <div class="fg1"><label class="fgl">Selskapsnavn *</label><input class="fgi" id="nc-nm" placeholder="f.eks. Regnskap AS"></div>
        <div class="fg1"><label class="fgl">Bransje</label>
          <select class="fgs" id="nc-br"><option>Regnskap</option><option>Eiendom</option><option>Helse</option><option>Bygg</option><option>Teknologi</option><option>Juridisk</option><option>Handel</option><option>Annen</option></select>
        </div>
      </div>
      <div class="slbl" style="margin:16px 0 10px;">Innlogging for kunden</div>
      <div style="background:rgba(47,139,255,.05);border:1px solid rgba(47,139,255,.15);border-radius:10px;padding:14px 16px;margin-bottom:14px;">
        <div class="fg2" style="margin-bottom:0;">
          <div class="fg1"><label class="fgl">Kontaktperson *</label><input class="fgi" id="nc-cp" placeholder="Kari Nordmann"></div>
          <div class="fg1"><label class="fgl">E-post (brukernavn) *</label><input class="fgi" id="nc-em" placeholder="kari@selskap.no" type="email"></div>
        </div>
        <div class="fg1" style="margin-bottom:0;">
          <label class="fgl">Passord</label>
          <div style="display:flex;gap:7px;align-items:center;">
            <input class="fgi" id="nc-pw" type="text" placeholder="Auto-generert" style="font-family:'DM Mono',monospace;flex:1;letter-spacing:1px;">
            <button class="btn btn-gh btn-sm" id="btn-nc-genpw" style="white-space:nowrap;flex-shrink:0;">ğŸ”€ Generer</button>
          </div>
          <div class="tmn" style="margin-top:4px;">Kunden bruker e-post + dette passordet for Ã¥ logge inn</div>
        </div>
      </div>
      <div class="slbl" style="margin-bottom:10px;">Avtale</div>
      <div class="fg2" style="margin-bottom:10px;">
        <div class="fg1">
          <label class="fgl">Avtalepris (kr/mnd) *</label>
          <input class="fgi" id="nc-avtale" type="number" placeholder="f.eks. 12500" min="0" style="font-family:'DM Mono',monospace;">
          <div class="tmn" style="margin-top:3px;">hva kunden betaler SCS</div>
        </div>
        <div class="fg1">
          <label class="fgl">Estimert besparelse (kr/mnd)</label>
          <input class="fgi" id="nc-besparing" type="number" placeholder="f.eks. 50000" min="0" style="font-family:'DM Mono',monospace;">
          <div class="tmn" style="margin-top:3px;">estimert lÃ¸nnskostnadsbesparelse</div>
        </div>
      </div>
      <div id="nc-roi-preview" style="display:none;background:rgba(0,229,160,.06);border:1px solid rgba(0,229,160,.15);border-radius:10px;padding:12px 16px;gap:20px;font-size:12.5px;margin-bottom:12px;">
        <div><div class="slbl">ROI</div><div style="font-weight:700;color:var(--g);font-size:16px;" id="nc-roi-val">â€”</div></div>
        <div><div class="slbl">Netto til kunden/mnd</div><div style="font-weight:700;color:var(--tx);font-size:16px;" id="nc-netto-val">â€”</div></div>
        <div><div class="slbl">Kunden beholder</div><div style="font-weight:700;color:var(--tx);font-size:16px;" id="nc-pct-val">â€”</div></div>
      </div>
      <div class="slbl" style="margin-bottom:7px;">Intern stÃ¸rrelse (vises ikke til kunden)</div>
      <div style="display:flex;gap:8px;" id="tier-sel">
        <div class="tsel" data-t="1" style="flex:1;padding:9px 11px;border:1.5px solid var(--t1e);background:var(--t1b);border-radius:9px;text-align:center;cursor:pointer;">
          <div style="font-weight:700;color:var(--t1);font-size:12px;">âš¡ Liten</div>
          <div class="tmn" style="margin-top:2px;">â‰¤5 agenter</div>
        </div>
        <div class="tsel" data-t="2" style="flex:1;padding:9px 11px;border:1.5px solid var(--b2);background:var(--s2);border-radius:9px;text-align:center;cursor:pointer;">
          <div style="font-weight:700;color:var(--m2);font-size:12px;">ğŸš€ Medium</div>
          <div class="tmn" style="margin-top:2px;">â‰¤15 agenter</div>
        </div>
        <div class="tsel" data-t="3" style="flex:1;padding:9px 11px;border:1.5px solid var(--b2);background:var(--s2);border-radius:9px;text-align:center;cursor:pointer;">
          <div style="font-weight:700;color:var(--m2);font-size:12px;">ğŸ† Stor</div>
          <div class="tmn" style="margin-top:2px;">50+ agenter</div>
        </div>
      </div>
    </div>
    <div class="mft">
      <button class="btn btn-gh mo-close">Avbryt</button>
      <button class="btn btn-g" id="btn-add-client">âœ… Opprett klient og bruker</button>
    </div>
  </div>
</div>

<!-- KLIENT OPPRETTET -->
<div class="mo" id="m-cl-done">
  <div class="mbox" style="width:min(480px,92vw);">
    <div class="mhd"><div class="mti">ğŸ‰ Klient opprettet!</div><button class="mcl mo-close">âœ•</button></div>
    <div class="mbd">
      <div style="background:rgba(0,229,160,.06);border:1px solid rgba(0,229,160,.2);border-radius:12px;padding:18px;margin-bottom:16px;">
        <div style="font-family:'Instrument Sans',sans-serif;font-weight:700;font-size:15px;margin-bottom:12px;" id="cl-done-nm">â€”</div>
        <div style="display:grid;grid-template-columns:auto 1fr;gap:6px 14px;font-size:12.5px;align-items:center;">
          <span class="tmn">E-POST</span>
          <span id="cl-done-em" style="font-family:'DM Mono',monospace;color:var(--g);">â€”</span>
          <span class="tmn">PASSORD</span>
          <div style="display:flex;align-items:center;gap:8px;">
            <span id="cl-done-pw" style="font-family:'DM Mono',monospace;font-weight:600;letter-spacing:1px;">â€”</span>
            <button class="btn btn-gh btn-sm" id="btn-kopier-tilgang" style="padding:3px 8px;font-size:11px;">ğŸ“‹ Kopier</button>
          </div>
          <span class="tmn">AVTALE</span>
          <span id="cl-done-tier" style="font-weight:600;">â€”</span>
        </div>
      </div>
      <div style="font-size:12px;color:var(--m2);line-height:1.6;">Send kunden e-post + passord over sikker kanal. De kan logge inn umiddelbart.</div>
    </div>
    <div class="mft" style="justify-content:space-between;">
      <button class="btn btn-gh btn-sm" id="btn-kopier-velkost">ğŸ“‹ Kopier velkomsttekst</button>
      <button class="btn btn-sm" id="btn-send-velkost" style="background:rgba(47,139,255,.1);color:var(--a);border:1px solid rgba(47,139,255,.25);">ğŸ“§ Send velkomst-epost</button>
      <button class="btn btn-g" id="btn-goto-kl">GÃ¥ til klientliste â†’</button>
    </div>
  </div>
</div>

<!-- INVITER BRUKER -->
<div class="mo" id="m-invuser">
  <div class="mbox">
    <div class="mhd"><div class="mti">ğŸ‘¤ Inviter bruker</div><button class="mcl mo-close">âœ•</button></div>
    <div class="mbd">
      <div class="fg2">
        <div class="fg1"><label class="fgl">Navn *</label><input class="fgi" id="inv-nm" placeholder="Kari Nordmann"></div>
        <div class="fg1"><label class="fgl">E-post *</label><input class="fgi" id="inv-em" placeholder="kari@selskap.no" type="email"></div>
      </div>
      <div style="background:rgba(47,139,255,.06);border:1px solid rgba(47,139,255,.15);border-radius:9px;padding:11px;font-size:12px;color:var(--m2);">ğŸ“§ Brukeren mottar en e-post med innloggingsinstruksjoner.</div>
    </div>
    <div class="mft">
      <button class="btn btn-gh mo-close">Avbryt</button>
      <button class="btn btn-g" id="btn-do-inviter">ğŸ“§ Send invitasjon</button>
    </div>
  </div>
</div>

<!-- KAPASITET FULL (client) -->
<div class="mo" id="m-upgrade">
  <div class="mbox">
    <div class="mhd"><div class="mti">â• Be om flere agenter</div><button class="mcl mo-close">âœ•</button></div>
    <div class="mbd">
      <div style="background:rgba(0,229,160,0.06);border:1px solid rgba(0,229,160,0.2);border-radius:10px;padding:14px;margin-bottom:18px;">
        <div style="font-weight:700;color:var(--g);margin-bottom:5px;">Send forespÃ¸rsel til SCS</div>
        <div style="font-size:12.5px;color:var(--m2);">SCS vil se forespÃ¸rselen din og ta kontakt for Ã¥ utvide avtalen.</div>
      </div>
      <div class="fg1"><label class="fgl">Antall agenter du Ã¸nsker</label><input class="fgi" id="upg-antall" type="number" min="1" max="20" placeholder="f.eks. 3" style="width:100%;"></div>
      <div class="fg1" style="margin-top:10px;"><label class="fgl">Hva skal agentene gjÃ¸re? (valgfritt)</label><textarea class="fgt" id="upg-msg" placeholder="Beskriv behovet ditt..." style="height:80px;"></textarea></div>
    </div>
    <div class="mft">
      <button class="btn btn-gh mo-close">Avbryt</button>
      <button class="btn btn-g" id="upg-send-btn">â• Send forespÃ¸rsel</button>
    </div>
  </div>
</div>


<!-- GLEMT PASSORD -->
<div class="mo" id="m-glemt-pw">
  <div class="mbox">
    <div class="mhd"><div class="mti">ğŸ” Glemt passord</div><button class="mcl mo-close">âœ•</button></div>
    <div class="mbd">
      <div style="background:rgba(47,139,255,.06);border:1px solid rgba(47,139,255,.15);border-radius:10px;padding:14px;margin-bottom:14px;font-size:12.5px;color:var(--m2);line-height:1.6;">
        Skriv inn e-posten din, sÃ¥ sender vi en lenke for Ã¥ tilbakestille passordet.
      </div>
      <div class="fg1"><label class="fgl">Din e-post</label><input class="fgi" id="forgot-em" placeholder="din@email.no" type="email"></div>
    </div>
    <div class="mft">
      <button class="btn btn-gh mo-close">Lukk</button>
      <button class="btn btn-b" id="btn-forgot-send">ğŸ“§ Send forespÃ¸rsel</button>
    </div>
  </div>
</div>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• JS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
'use strict';

/* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   â•‘  SUPABASE INITIALIZATION
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
// Fyll inn fra Supabase Dashboard â†’ Settings â†’ API
const _SB_URL = 'https://skizmerlxzvwrlajqcmq.supabase.co';
const _SB_KEY = 'sb_publishable_XwMhozVOupwe5Vc0nSZvPg_wl-UbwD4';

function _getSBConfig() {
  try {
    const s = JSON.parse(localStorage.getItem('scs_sb') || '{}');
    return { url: s.url || _SB_URL, key: s.key || _SB_KEY };
  } catch { return { url: _SB_URL, key: _SB_KEY }; }
}

let sb = null;
function initSupabase() {
  const c = _getSBConfig();
  if (c.url && c.key && window.supabase) {
    sb = window.supabase.createClient(c.url, c.key);
  }
  return !!sb;
}
initSupabase();

/* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   â•‘  REFERENCE DATA
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const TIER_CFG = {
  1: { name:'Liten',  max:5,  icon:'âš¡', color:'var(--t1)' },
  2: { name:'Medium', max:10, icon:'ğŸš€', color:'var(--t2)' },
  3: { name:'Stor',   max:20, icon:'ğŸ†', color:'var(--t3)' },
};
const ACT_T = [
  { ic:'ğŸ“¬', bg:'rgba(0,229,160,0.1)',   msg: co => `<strong>${co}</strong> svarte automatisk pÃ¥ e-post` },
  { ic:'ğŸ¯', bg:'rgba(255,107,53,0.1)',  msg: _  => `<strong>Ny lead</strong> fanget og registrert i CRM` },
  { ic:'ğŸ“', bg:'rgba(47,139,255,0.1)',  msg: _  => `<strong>Voice</strong> fullfÃ¸rte kundesamtale` },
  { ic:'ğŸ¢', bg:'rgba(157,96,251,0.1)',  msg: _  => `<strong>CRM</strong> oppdatert â€” ny kontakt lagt til` },
  { ic:'â­', bg:'rgba(245,158,11,0.1)',  msg: _  => `<strong>Anmeldelse</strong> svart pÃ¥ automatisk` },
];
const LOG_T = [
  { l:'OK',   c:'lok', a:'email-support', m:'E-post besvart automatisk â€” 1.1s' },
  { l:'OK',   c:'lok', a:'lead-capture',  m:'Ny lead lagret i HubSpot CRM' },
  { l:'INFO', c:'lin', a:'voice-agent',   m:'Samtale avsluttet â€” 3m 02s' },
  { l:'OK',   c:'lok', a:'system',        m:'Gmail synkronisert â€” 12 nye meldinger' },
  { l:'WARN', c:'lwa', a:'email-support', m:'Eskalering utlÃ¸st â€” kundehenvendelse' },
  { l:'OK',   c:'lok', a:'crm-sync',      m:'HubSpot kontakter oppdatert' },
];

/* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   â•‘  STATE
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let CU = null;
let loginRole = 'admin';
let selTier = 1;
let _lastClient = {};
let CLIENTS = [];
let AGENTS = [];

/* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   â•‘  DATA MAPPING (Supabase â†’ internal format)
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function mapClient(c) {
  return {
    id: c.id, n: c.name, b: c.bransje || '', t: c.tier_id,
    ag: parseInt(c.agent_count) || 0, act: parseInt(c.total_actions) || 0,
    avtale: c.avtale_kr || 0, besparing: c.besparing_kr || 0,
    roi: parseFloat(c.roi) || 0,
    apiKost: parseFloat(c.api_kost_kr) || 0, apiGrense: parseFloat(c.api_grense_kr) || 0,
    s: c.status || 'aktiv', av: c.avatar_letter || c.name?.[0] || '?',
    c: c.avatar_color || '#2f8bff',
    contactName: c.contact_name || '', contactEmail: c.contact_email || '',
    generalKnowledge: c.general_knowledge || '',
    voiceProvider: c.voice_provider || 'VAPI',
    webhookUrl: c.webhook_url || '', n8nUrl: c.n8n_url || '',
    agents: [],
  };
}

function mapAgent(a) {
  return {
    id: a.id, clientId: a.client_id,
    nm: a.name, em: a.emoji || 'ğŸ¤–',
    bg: a.bg_color || 'rgba(47,139,255,0.1)', ch: a.channels || '',
    act: a.total_actions || 0, rate: parseFloat(a.success_rate) || 0,
    status: a.status || 'aktiv', klient: a.client_name || '',
    tone: a.tone || 'Profesjonell', greeting: a.greeting || '',
    knowledge: a.knowledge || '', clientKnowledge: a.client_knowledge || '',
    clientFeedback: a.client_feedback || '', webhook: a.webhook_url || '',
    voiceName: a.voice_name || 'Sofia',
  };
}

/* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   â•‘  UTILS
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function el(id) { return document.getElementById(id); }

function animV(id, val) {
  const e = el(id); if (!e) return;
  e.classList.remove('anim-v'); void e.offsetWidth;
  e.classList.add('anim-v'); e.textContent = val;
}
function liveV(id, val) { const e = el(id); if (e) e.textContent = val; }

function toast(msg, type = 'ok') {
  const color = { ok:'var(--g)', err:'var(--er)', warn:'var(--wa)', info:'var(--b1)' }[type] || 'var(--g)';
  const t = document.createElement('div');
  t.style.cssText = `position:fixed;bottom:24px;right:24px;z-index:9999;padding:12px 20px;background:var(--s2);border:1px solid ${color};border-radius:10px;color:${color};font-family:'DM Mono',monospace;font-size:12px;pointer-events:none;box-shadow:0 8px 32px rgba(0,0,0,.5);animation:fadeIn 0.2s ease;`;
  t.textContent = msg;
  document.body.appendChild(t);
  setTimeout(() => { t.style.transition='opacity .3s'; t.style.opacity='0'; setTimeout(() => t.remove(), 300); }, 2400);
}

function buildChart(id, color, vals) {
  const e = el(id); if (!e) return;
  e.innerHTML = '';
  const mx = Math.max(...vals, 1);
  vals.forEach((v, i) => {
    const b = document.createElement('div');
    b.className = 'mcb';
    b.style.cssText = `height:${Math.max(v/mx*100,6)}%;background:${color};opacity:${i===vals.length-1?'0.9':'0.35'};`;
    e.appendChild(b);
  });
}

function openModal(id) { const m = el(id); if (m) m.classList.add('on'); }
function closeModal(id) { const m = el(id); if (m) m.classList.remove('on'); }
function fmtKr(n) { return Math.round(n).toLocaleString('no-NO') + ' kr'; }
function fmtKrK(n) { return n >= 1000 ? (n/1000).toFixed(1) + 'k' : fmtKr(n); }

/* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   â•‘  NAVIGATION
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function aGo(pageId) {
  document.querySelectorAll('#v-admin .pg').forEach(p => p.classList.remove('on'));
  document.querySelectorAll('.ani').forEach(n => n.classList.remove('on'));
  const p = el('pg-' + pageId); if (p) p.classList.add('on');
  const ni = document.querySelector(`.ani[data-page="${pageId}"]`); if (ni) ni.classList.add('on');
}
function cGo(pageId) {
  document.querySelectorAll('.cpg').forEach(p => p.classList.remove('on'));
  document.querySelectorAll('.cni').forEach(n => n.classList.remove('on'));
  const p = el('cpg-' + pageId); if (p) p.classList.add('on');
  const ni = document.querySelector(`.cni[data-cpage="${pageId}"]`); if (ni) ni.classList.add('on');
}

/* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   â•‘  CLOCK
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function tickClock() {
  const t = new Date().toLocaleTimeString('no-NO');
  const a = el('a-clk'), c = el('c-clk');
  if (a) a.textContent = t; if (c) c.textContent = t;
}
setInterval(tickClock, 1000); tickClock();

/* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   â•‘  AUTH
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function doLogin() {
  const email = el('lin-em').value.trim().toLowerCase();
  const pw = el('lin-pw').value;
  const errEl = el('lerr');
  errEl.classList.remove('on');

  if (!sb) {
    errEl.textContent = 'Supabase er ikke konfigurert. Fyll inn URL og Key i Innstillinger.';
    errEl.classList.add('on');
    return;
  }

  const btn = el('lbtn');
  const orig = btn.innerHTML;
  btn.innerHTML = '<span>â³</span> <span>Logger inn...</span>'; btn.disabled = true;

  const { data, error } = await sb.auth.signInWithPassword({ email, password: pw });
  if (error) {
    errEl.textContent = error.message === 'Invalid login credentials' ? 'Feil e-post eller passord.' : error.message;
    errEl.classList.add('on');
    btn.innerHTML = orig; btn.disabled = false;
    return;
  }

  const { data: profile, error: profErr } = await sb.from('users').select('*').eq('auth_id', data.user.id).single();
  if (profErr || !profile) {
    errEl.textContent = 'Ingen brukerprofil funnet. Kontakt admin.';
    errEl.classList.add('on');
    btn.innerHTML = orig; btn.disabled = false;
    await sb.auth.signOut();
    return;
  }

  CU = profile;
  btn.innerHTML = orig; btn.disabled = false;
  el('v-login').classList.remove('on');

  if (CU.role === 'admin') {
    el('v-admin').classList.add('on');
    await bootAdmin();
  } else {
    el('v-client').classList.add('on');
    await bootClient();
  }
}

async function logout() {
  if (sb) await sb.auth.signOut();
  CU = null;
  CLIENTS.length = 0;
  AGENTS.length = 0;
  el('v-admin').classList.remove('on');
  el('v-client').classList.remove('on');
  el('v-login').classList.add('on');
  el('lin-em').value = ''; el('lin-pw').value = '';
}

/* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   â•‘  DATA LOADING
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function loadAdminData() {
  const { data: clients } = await sb.from('v_client_summary').select('*').order('created_at', { ascending: false });
  const { data: agents } = await sb.from('v_agent_overview').select('*').order('created_at', { ascending: false });

  CLIENTS = (clients || []).map(mapClient);
  AGENTS = (agents || []).map(mapAgent);

  CLIENTS.forEach(cl => {
    cl.agents = AGENTS.filter(a => a.clientId === cl.id);
    cl.ag = cl.agents.length;
    cl.act = cl.agents.reduce((s, a) => s + a.act, 0);
  });
}

/* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   â•‘  ADMIN BOOT
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function bootAdmin() {
  el('a-av').textContent = (CU.display_name || 'A')[0];
  el('a-uname').textContent = CU.display_name || 'Admin';
  setConnBadge(true);

  await loadAdminData();

  renderAdminFeed();
  renderLogFeed();
  renderAgentCards();
  renderClientsTable();
  renderUsersTable();
  renderAvtaleTabell();
  renderApiKostnader();
  renderFakturering();
  updateAdminStats();
  initAdminCharts();
}

function setConnBadge(live) {
  const badge = el('conn-badge'); if (!badge) return;
  badge.textContent = live ? 'â— Supabase Live' : 'â— Ikke tilkoblet';
  const sb2 = badge.closest('.asb-mode');
  if (sb2) sb2.style.color = live ? 'var(--g)' : 'var(--mu)';
}

function updateAdminStats() {
  const totalMRR       = CLIENTS.reduce((s, cl) => s + (cl.avtale || 0), 0);
  const totalBesparing = CLIENTS.reduce((s, cl) => s + (cl.besparing || 0), 0);
  const totalAct       = CLIENTS.reduce((s, cl) => s + (cl.act || 0), 0);
  const avgROI         = CLIENTS.length ? (CLIENTS.reduce((s, cl) => s + (cl.besparing || 0) / (cl.avtale || 1), 0) / CLIENTS.length).toFixed(1) : 0;
  const totAg          = AGENTS.length;
  const leads          = Math.floor(totalAct * 0.034);

  animV('adb-act', totalAct.toLocaleString('no-NO'));
  animV('adb-leads', leads);
  animV('adb-cl', CLIENTS.length);
  animV('adb-ag', totAg);
  animV('adb-em', AGENTS[0]?.act?.toLocaleString('no-NO') || '0');
  animV('adb-vo', AGENTS[1]?.act?.toLocaleString('no-NO') || '0');
  animV('adb-lc', leads);
  animV('aa1', AGENTS[0]?.act?.toLocaleString('no-NO') || '0');
  animV('aa2', AGENTS[1]?.act?.toLocaleString('no-NO') || '0');
  animV('aa3', AGENTS[2]?.act?.toLocaleString('no-NO') || '0');
  animV('aa4', AGENTS[3]?.act?.toLocaleString('no-NO') || '0');

  animV('kl-mrr', fmtKrK(totalMRR));
  animV('kl-tot', CLIENTS.length);
  animV('kl-ag', totAg);
  animV('sb-cl', CLIENTS.length);
  animV('sb-ag', totAg);

  animV('roi-h', Math.round(totalMRR * 0.68 / 600) + 't');
  animV('roi-s', fmtKr(totalBesparing));
  animV('roi-mrr', fmtKr(totalMRR));
  animV('roi-n', fmtKr(totalBesparing - totalMRR));

  animV('av-mrr', fmtKr(totalMRR));
  animV('av-besparing', fmtKrK(totalBesparing));
  animV('av-roi', avgROI + 'x');
  animV('av-antall', CLIENTS.length);

  const admMrr = el('adm-mrr-set'); if (admMrr) admMrr.textContent = fmtKr(totalMRR);
  const admRoi = el('adm-avg-roi-set'); if (admRoi) admRoi.textContent = avgROI + 'x';
  animV('adm-tot-besparing', fmtKr(totalBesparing));
  animV('ag-tot', totalAct.toLocaleString('no-NO'));
  animV('fak-mrr', fmtKr(totalMRR));
  animV('fak-arr', (totalMRR * 12 >= 1000000 ? (totalMRR * 12 / 1000000).toFixed(2) + 'M' : fmtKrK(totalMRR * 12)));
  const maxed = CLIENTS.filter(cl => cl.ag >= (TIER_CFG[cl.t]?.max || 999)).length;
  animV('kl-max', maxed);
}

/* â”€â”€ CHARTS â”€â”€ */
function initAdminCharts() {
  const emVals = AGENTS.filter(a => a.ch?.includes('Email') || a.ch?.includes('Gmail')).map(a => a.act);
  const voVals = AGENTS.filter(a => a.ch?.includes('VAPI') || a.ch?.includes('Voice')).map(a => a.act);
  buildChart('adb-emc', '#00e5a0', emVals.length ? emVals : [0]);
  buildChart('adb-vmc', '#2f8bff', voVals.length ? voVals : [0]);
  buildChart('adb-lmc', '#ff6b35', CLIENTS.map(c => Math.floor(c.act * 0.034)) || [0]);
}

/* â”€â”€ FEEDS â”€â”€ */
function renderAdminFeed() {
  const feed = el('a-feed'); if (!feed) return;
  feed.innerHTML = '';
  if (CLIENTS.length) for (let i = 0; i < 5; i++) pushAdminFeed(false);
  else feed.innerHTML = '<div style="padding:16px;color:var(--mu);font-size:12.5px;text-align:center;">Ingen aktivitet enda. Opprett din forste klient!</div>';
}
function pushAdminFeed(flash = true) {
  const feed = el('a-feed'); if (!feed || !CLIENTS.length) return;
  const t = ACT_T[Math.floor(Math.random() * ACT_T.length)];
  const cl = CLIENTS[Math.floor(Math.random() * CLIENTS.length)];
  const now = new Date().toLocaleTimeString('no-NO');
  const d = document.createElement('div');
  d.className = 'ai' + (flash ? ' fn' : '');
  d.innerHTML = `<div class="aic" style="background:${t.bg}">${t.ic}</div><div><div style="font-size:12px;">${t.msg(cl.n)}</div><div style="font-size:10px;color:var(--mu);font-family:'DM Mono',monospace;margin-top:1px;">${now} Â· ${cl.n}</div></div>`;
  feed.insertBefore(d, feed.firstChild);
  while (feed.children.length > 6) feed.removeChild(feed.lastChild);
}

function renderLogFeed() {
  const feed = el('log-feed'); if (!feed) return;
  feed.innerHTML = '';
  for (let i = 0; i < 10; i++) pushLog(false);
}
function pushLog(flash = true) {
  const feed = el('log-feed'); if (!feed) return;
  const t = LOG_T[Math.floor(Math.random() * LOG_T.length)];
  const now = new Date().toLocaleString('no-NO');
  const e = document.createElement('div');
  e.className = 'loge' + (flash ? ' fn' : '');
  e.innerHTML = `<div class="lt">${now}</div><div class="ll ${t.c}">${t.l}</div><div class="tmn" style="width:110px;flex-shrink:0;">${t.a}</div><div style="flex:1;font-size:10.5px;">${t.m}</div>`;
  feed.insertBefore(e, feed.firstChild);
  while (feed.children.length > 14) feed.removeChild(feed.lastChild);
}

/* â”€â”€ AGENT CARDS â”€â”€ */
function renderAgentCards() {
  const g = el('ag-cards'); if (!g) return;
  g.innerHTML = '';
  if (!AGENTS.length) {
    g.innerHTML = '<div class="card" style="padding:30px;text-align:center;grid-column:1/-1;"><div style="font-size:28px;margin-bottom:8px;">ğŸ¤–</div><div style="color:var(--mu);font-size:13px;">Ingen agenter opprettet enda.</div></div>';
    return;
  }
  AGENTS.slice(0, 8).forEach((a, i) => {
    const rc = a.rate >= 90 ? 'var(--g)' : a.rate >= 80 ? 'var(--o)' : 'var(--er)';
    const d = document.createElement('div');
    d.className = 'card'; d.style.padding = '17px';
    d.innerHTML = `
      <div style="display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:12px;">
        <div style="display:flex;align-items:center;gap:10px;">
          <div style="width:36px;height:36px;border-radius:9px;background:${a.bg};display:flex;align-items:center;justify-content:center;font-size:16px;">${a.em}</div>
          <div><div style="font-weight:700;font-size:13px;">${a.nm}</div><div class="tmn" style="margin-top:2px;">${a.ch}</div><div class="tmn" style="font-size:10px;">${a.klient}</div></div>
        </div>
        <span class="bge ${a.status==='aktiv'?'ba':'bp'}">${(a.status||'aktiv').toUpperCase()}</span>
      </div>
      <div style="display:flex;gap:14px;border-top:1px solid var(--b);padding-top:11px;margin-bottom:11px;">
        <div><div style="font-family:'Instrument Sans',sans-serif;font-weight:600;font-size:19px;">${a.act.toLocaleString('no-NO')}</div><div class="tmn">Handlinger</div></div>
        <div><div style="font-family:'Instrument Sans',sans-serif;font-weight:600;font-size:16px;color:${rc};">${a.rate}%</div><div class="tmn">Suksessrate</div></div>
      </div>
      <div style="display:flex;gap:6px;">
        <button class="btn btn-gh btn-sm ag-pause-btn">â¸ Pause</button>
        <button class="btn btn-gh btn-sm ag-edit-btn">âœï¸ Rediger</button>
      </div>`;
    d.querySelector('.ag-pause-btn').addEventListener('click', async () => {
      const newS = a.status === 'aktiv' ? 'pauset' : 'aktiv';
      await sb.from('agents').update({ status: newS }).eq('id', a.id);
      a.status = newS;
      renderAgentCards();
      toast(a.nm + (newS === 'aktiv' ? ' gjenopptatt' : ' satt pa pause'), newS === 'aktiv' ? 'ok' : 'warn');
    });
    d.querySelector('.ag-edit-btn').addEventListener('click', () => {
      openDynModal('m-edit-agent', `<div class="mhd"><div class="mti">âœï¸ Rediger agent</div><button class="mcl mo-close">âœ•</button></div>
        <div class="mbd"><div class="fg1"><label class="fgl">Navn</label><input class="fgi" id="ea-nm" value="${a.nm}"></div>
        <div class="fg1"><label class="fgl">Kanal</label><input class="fgi" id="ea-ch" value="${a.ch}"></div></div>
        <div class="mft"><button class="btn btn-gh mo-close">Avbryt</button>
        <button class="btn btn-g" id="ea-save">ğŸ’¾ Lagre</button></div>`);
      el('ea-save').addEventListener('click', async () => {
        const nm = el('ea-nm').value || a.nm;
        const ch = el('ea-ch').value || a.ch;
        await sb.from('agents').update({ name: nm, channels: ch }).eq('id', a.id);
        a.nm = nm; a.ch = ch;
        renderAgentCards();
        closeModal('m-edit-agent');
        toast('Agent oppdatert');
      });
    });
    g.appendChild(d);
  });
}

/* â”€â”€ CLIENTS TABLE â”€â”€ */
function renderClientsTable(filt = '', tier = '') {
  const tb = el('cl-tbody'); if (!tb) return;
  const tn = { 1:'âš¡ Liten', 2:'ğŸš€ Medium', 3:'ğŸ† Stor' };
  const filtered = CLIENTS.filter(cl => {
    if (filt && !cl.n.toLowerCase().includes(filt.toLowerCase()) && !cl.b.toLowerCase().includes(filt.toLowerCase())) return false;
    if (tier && cl.t !== parseInt(tier)) return false;
    return true;
  });
  if (!filtered.length) {
    tb.innerHTML = '<tr><td colspan="9" style="text-align:center;padding:30px;color:var(--mu);">Ingen klienter enda. Klikk \"+ Ny klient\" for a opprette.</td></tr>';
    return;
  }
  tb.innerHTML = filtered.map((cl, idx) => {
    const roi = cl.avtale ? (cl.besparing / cl.avtale).toFixed(1) : 'â€”';
    const rc = roi >= 4 ? 'var(--g)' : roi >= 3 ? 'var(--au)' : 'var(--m2)';
    return `<tr>
      <td><div style="display:flex;align-items:center;gap:9px;">
        <div class="av" style="background:${cl.c}22;color:${cl.c};">${cl.av}</div>
        <div><div style="font-weight:600;">${cl.n}</div><div class="tmn">${cl.b}</div></div>
      </div></td>
      <td><span class="bge" style="font-size:9.5px;">${tn[cl.t]||'â€”'}</span></td>
      <td class="tmn">${cl.ag}</td>
      <td class="tmn">${(cl.act||0).toLocaleString('no-NO')}</td>
      <td style="font-family:'DM Mono',monospace;font-weight:700;">${fmtKr(cl.avtale)}</td>
      <td style="font-family:'DM Mono',monospace;color:var(--g);font-weight:600;">${fmtKr(cl.besparing)}</td>
      <td style="font-family:'Instrument Sans',sans-serif;font-weight:700;font-size:14px;color:${rc};">${roi}x</td>
      <td><span class="bge ${cl.s==='aktiv'?'ba':'bp'}">${cl.s.toUpperCase()}</span></td>
      <td><button class="btn btn-gh btn-sm cl-det-btn" data-id="${cl.id}">Detaljer</button></td>
    </tr>`;
  }).join('');
  tb.querySelectorAll('.cl-det-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const cl = CLIENTS.find(c => c.id === btn.dataset.id);
      if (cl) visKlientDetaljer(cl);
    });
  });
}

function visKlientDetaljer(cl) {
  const roi = cl.avtale ? (cl.besparing / cl.avtale).toFixed(1) : 'â€”';
  const tn = { 1:'âš¡ Liten', 2:'ğŸš€ Medium', 3:'ğŸ† Stor' };
  const s = cl.s || 'aktiv';
  const sLabel = s==='aktiv' ? 'âœ… Aktiv' : s==='pauset' ? 'â¸ Pause' : 'ğŸ“¦ Arkivert';
  const sColor = s==='aktiv' ? 'var(--g)' : s==='pauset' ? 'var(--wa)' : 'var(--mu)';

  const agenter = cl.agents || [];
  const agKnowHtml = agenter.length
    ? agenter.map(a => {
        const tones = ['Profesjonell','Vennlig','Uformell','Teknisk'].map(t =>
          '<option' + ((a.tone||'Profesjonell')===t?' selected':'') + '>' + t + '</option>').join('');
        return '<div style="border:1px solid var(--b2);border-radius:10px;padding:12px;margin-bottom:10px;">'
          + '<div style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">'
          + '<span style="font-size:14px;">' + (a.em||'ğŸ¤–') + '</span>'
          + '<div style="flex:1;font-weight:700;font-size:12.5px;">' + a.nm + '</div>'
          + '<select class="fgs adm-ag-status" data-aid="' + a.id + '" style="font-size:11px;width:auto;padding:3px 7px;">'
          + '<option' + (a.status==='aktiv'?' selected':'') + ' value="aktiv">âœ… Aktiv</option>'
          + '<option' + (a.status!=='aktiv'?' selected':'') + ' value="pauset">â¸ Pause</option></select></div>'
          + '<div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:8px;">'
          + '<div><label class="fgl" style="margin-bottom:3px;">Tone</label>'
          + '<select class="fgs adm-ag-tone" data-aid="' + a.id + '" style="font-size:11px;">' + tones + '</select></div>'
          + '<div><label class="fgl" style="margin-bottom:3px;">Apningshilsen</label>'
          + '<input class="fgi adm-ag-greeting" data-aid="' + a.id + '" value="' + (a.greeting||'').replace(/"/g,'&quot;') + '" placeholder="Hei! Takk for at du kontaktet oss." style="font-size:11px;"></div></div>'
          + '<div><label class="fgl" style="margin-bottom:3px;">ğŸ“š Agent-kunnskap (kun admin)</label>'
          + '<textarea class="fgt adm-ag-know" data-aid="' + a.id + '" style="height:100px;font-size:12px;width:100%;" placeholder="Produktinfo, priser, FAQ...">'
          + (a.knowledge||'') + '</textarea></div>'
          + '<div style="margin-top:8px;"><label class="fgl" style="margin-bottom:3px;">ğŸ”— Webhook URL (n8n)</label>'
          + '<input class="fgi adm-ag-webhook" data-aid="' + a.id + '" value="' + (a.webhook||'') + '" placeholder="https://n8n.../webhook/..." style="font-size:11px;width:100%;font-family:monospace;"></div></div>';
      }).join('')
    : '<div style="color:var(--mu);font-size:12px;padding:8px 0;">Ingen agenter tilordnet enda.</div>';

  const html = `<div class="mhd"><div class="mti" style="display:flex;align-items:center;gap:10px;"><span style="font-size:20px;">${cl.av||'ğŸ¢'}</span><div><div>${cl.n}</div><div style="font-size:12px;font-weight:400;color:${sColor};">${sLabel}</div></div></div><button class="mcl mo-close">âœ•</button></div>
  <div class="mbd" style="max-height:80vh;overflow-y:auto;">
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:9px;margin-bottom:16px;">
      ${[['Bransje',cl.b],['Tier',tn[cl.t]||'â€”'],['ROI',roi+'x'],['Agenter',cl.ag||0],['Avtale/mnd',fmtKr(cl.avtale)],['Sparer/mnd',fmtKr(cl.besparing)]].map(([l,v])=>'<div style="background:var(--s3);border-radius:9px;padding:10px;"><div class="tmn" style="margin-bottom:3px;">'+l+'</div><div style="font-weight:700;font-size:13px;">'+v+'</div></div>').join('')}
    </div>
    <div style="display:flex;gap:8px;margin-bottom:16px;">
      <button class="btn btn-sm" id="adm-kl-toggle" style="flex:1;background:${s==='aktiv'?'rgba(255,170,0,.12)':'rgba(0,229,160,.1)'};color:${s==='aktiv'?'var(--wa)':'var(--g)'};border:1px solid ${s==='aktiv'?'rgba(255,170,0,.3)':'rgba(0,229,160,.3)'};">${s==='aktiv'?'â¸ Sett pa pause':'â–¶ Aktiver'}</button>
      <button class="btn btn-sm" id="adm-kl-archive" style="flex:1;background:rgba(100,100,120,.1);color:var(--mu);border:1px solid rgba(100,100,120,.2);">ğŸ“¦ ${s==='arkivert'?'Gjenopprett':'Arkiver'}</button>
      <button class="btn btn-sm" id="adm-kl-delete" style="flex:1;background:rgba(255,59,48,.08);color:var(--er);border:1px solid rgba(255,59,48,.2);">ğŸ—‘ Slett</button>
      <button class="btn btn-g btn-sm" id="adm-kl-save" style="flex:1;">ğŸ’¾ Lagre</button>
    </div>
    <div style="font-size:12px;font-weight:700;color:var(--mu);text-transform:uppercase;letter-spacing:.8px;margin-bottom:10px;">ğŸ¤– Agenter & kunnskap</div>
    <div id="adm-ag-list">${agKnowHtml}</div>
  </div>`;

  openDynModal('m-klient-det', html);

  el('adm-kl-toggle').addEventListener('click', async () => {
    const newS = cl.s === 'aktiv' ? 'pauset' : 'aktiv';
    await sb.from('clients').update({ status: newS }).eq('id', cl.id);
    cl.s = newS;
    renderClientsTable();
    toast(cl.n + (newS === 'aktiv' ? ' aktivert' : ' satt pa pause'), newS === 'aktiv' ? 'ok' : 'warn');
    closeModal('m-klient-det');
  });

  el('adm-kl-archive').addEventListener('click', async () => {
    const newS = cl.s === 'arkivert' ? 'aktiv' : 'arkivert';
    await sb.from('clients').update({ status: newS }).eq('id', cl.id);
    cl.s = newS;
    renderClientsTable();
    toast(cl.n + (newS === 'arkivert' ? ' arkivert' : ' gjenopprettet'), newS === 'arkivert' ? 'warn' : 'ok');
    closeModal('m-klient-det');
  });

  el('adm-kl-delete').addEventListener('click', async () => {
    if (!confirm('Er du sikker pa at du vil slette ' + cl.n + '? Dette sletter klienten, alle agenter og tilknyttede data permanent.')) return;
    if (!confirm('Siste sjanse â€” dette kan ikke angres. Slett ' + cl.n + '?')) return;
    await sb.from('clients').delete().eq('id', cl.id);
    await loadAdminData();
    renderClientsTable();
    renderAgentCards();
    updateAdminStats();
    renderUsersTable();
    closeModal('m-klient-det');
    toast(cl.n + ' slettet permanent', 'warn');
  });

  el('adm-kl-save').addEventListener('click', async () => {
    const updates = [];
    document.querySelectorAll('.adm-ag-status').forEach(s2 => {
      updates.push(sb.from('agents').update({ status: s2.value }).eq('id', s2.dataset.aid));
    });
    document.querySelectorAll('.adm-ag-tone').forEach(t => {
      updates.push(sb.from('agents').update({ tone: t.value }).eq('id', t.dataset.aid));
    });
    document.querySelectorAll('.adm-ag-greeting').forEach(g => {
      updates.push(sb.from('agents').update({ greeting: g.value.trim() }).eq('id', g.dataset.aid));
    });
    document.querySelectorAll('.adm-ag-know').forEach(k => {
      updates.push(sb.from('agents').update({ knowledge: k.value.trim() }).eq('id', k.dataset.aid));
    });
    document.querySelectorAll('.adm-ag-webhook').forEach(w => {
      updates.push(sb.from('agents').update({ webhook_url: w.value.trim() }).eq('id', w.dataset.aid));
    });
    await Promise.all(updates);
    await loadAdminData();
    renderAgentCards();
    renderClientsTable();
    toast('Lagret');
  });
}

/* â”€â”€ USERS TABLE â”€â”€ */
async function renderUsersTable() {
  const tb = el('usr-tbody'); if (!tb) return;
  const { data: users } = await sb.from('users').select('*').order('role');
  if (!users?.length) {
    tb.innerHTML = '<tr><td colspan="5" style="text-align:center;padding:20px;color:var(--mu);">Ingen brukere</td></tr>';
    return;
  }
  tb.innerHTML = users.map(u => {
    const isAdmin = u.role === 'admin';
    return `<tr>
      <td><div style="font-weight:600;">${u.display_name || u.company || 'Ukjent'}</div><div class="tmn">${u.email}</div></td>
      <td><span class="bge ${isAdmin?'ba':'bt2'}">${isAdmin?'SCS ADMIN':'KLIENT'}</span></td>
      <td style="font-size:12px;color:${isAdmin?'var(--g)':'var(--m2)'};">${isAdmin?'Alt inkl. alle klienter':'Kun eget dashboard'}</td>
      <td class="tmn">${u.last_login ? new Date(u.last_login).toLocaleDateString('no-NO') : 'â€”'}</td>
      <td></td>
    </tr>`;
  }).join('');
}

/* â”€â”€ AVTALER TABLE â”€â”€ */
function renderAvtaleTabell() {
  const tb = el('av-tbody'); if (!tb) return;
  const tn = { 1:'âš¡ Liten', 2:'ğŸš€ Medium', 3:'ğŸ† Stor' };
  const sorted = [...CLIENTS].sort((a, b) => (b.besparing||0) - (a.besparing||0));
  if (!sorted.length) { tb.innerHTML = '<tr><td colspan="8" style="text-align:center;padding:20px;color:var(--mu);">Ingen avtaler</td></tr>'; return; }
  tb.innerHTML = sorted.map(cl => {
    const netto = (cl.besparing||0) - (cl.avtale||0);
    const roi = cl.avtale ? (cl.besparing / cl.avtale).toFixed(1) : 'â€”';
    const rc = roi >= 4 ? 'var(--g)' : roi >= 3 ? 'var(--au)' : 'var(--m2)';
    return `<tr>
      <td><div style="font-weight:600;">${cl.n}</div><div class="tmn">${cl.b}</div></td>
      <td><span class="bge" style="font-size:9.5px;">${tn[cl.t]||'â€”'}</span></td>
      <td class="tmn">${cl.ag}</td>
      <td style="font-family:'DM Mono',monospace;font-weight:700;">${fmtKr(cl.avtale)}</td>
      <td style="font-family:'DM Mono',monospace;color:var(--g);font-weight:600;">${fmtKr(cl.besparing)}</td>
      <td style="font-family:'Instrument Sans',sans-serif;font-weight:700;color:${rc};">${roi}x</td>
      <td style="font-family:'DM Mono',monospace;color:var(--g);">${fmtKr(netto)}</td>
      <td><span class="bge ${cl.s==='aktiv'?'ba':'bp'}">${cl.s.toUpperCase()}</span></td>
    </tr>`;
  }).join('');
}

/* â”€â”€ API KOSTNADER â”€â”€ */
function renderApiKostnader() {
  const tb = el('api-tbody'), varslerDiv = el('api-varsler');
  if (!tb) return;
  const sorted = [...CLIENTS].sort((a, b) => (b.apiKost||0) - (a.apiKost||0));
  if (!sorted.length) { tb.innerHTML = '<tr><td colspan="7" style="text-align:center;padding:20px;color:var(--mu);">Ingen data</td></tr>'; return; }
  let totKost = 0, over = 0, naer = 0, varsler = [];
  tb.innerHTML = sorted.map(cl => {
    const kost = cl.apiKost || 0, grense = cl.apiGrense || 2000;
    const pct = Math.min(Math.round(kost / grense * 100), 100);
    const isOver = kost > grense, isWarn = !isOver && pct >= 80;
    totKost += kost;
    if (isOver) { over++; varsler.push({ nm:cl.n, kost, grense, type:'over' }); }
    if (isWarn) { naer++; varsler.push({ nm:cl.n, kost, grense, type:'warn' }); }
    const bc = isOver ? 'var(--er)' : isWarn ? 'var(--wa)' : 'var(--g)';
    const badge = isOver ? '<span class="bge be">OVER GRENSE</span>' : isWarn ? '<span class="bge bp">NAER GRENSE</span>' : '<span class="bge ba">OK</span>';
    return `<tr>
      <td><div style="font-weight:600;">${cl.n}</div><div class="tmn">${cl.b}</div></td>
      <td class="tmn">${cl.ag}</td>
      <td style="font-family:'DM Mono',monospace;font-weight:700;color:${isOver?'var(--er)':isWarn?'var(--wa)':'var(--tx)'};">${fmtKr(kost)}</td>
      <td class="tmn">${fmtKr(grense)}</td>
      <td style="min-width:110px;"><div style="display:flex;align-items:center;gap:7px;"><div class="pb" style="flex:1;"><div class="pbf" style="width:${pct}%;background:${bc};"></div></div><span style="font-family:'DM Mono',monospace;font-size:10px;color:${bc};min-width:28px;">${pct}%</span></div></td>
      <td>${badge}</td>
      <td><button class="btn btn-gh btn-sm varsle-btn" data-nm="${cl.n}" data-kost="${kost}" data-grense="${grense}">ğŸ“§ Varsle</button></td>
    </tr>`;
  }).join('');
  tb.querySelectorAll('.varsle-btn').forEach(btn => {
    btn.addEventListener('click', () => varsleKlient(btn.dataset.nm, parseInt(btn.dataset.kost), parseInt(btn.dataset.grense)));
  });
  const avg = sorted.length ? Math.round(totKost / sorted.length) : 0;
  animV('api-tot', fmtKr(totKost));
  const overEl = el('api-over'); if (overEl) { overEl.textContent = over; overEl.style.color = over > 0 ? 'var(--er)' : 'var(--g)'; }
  const warnEl = el('api-warn'); if (warnEl) { warnEl.textContent = naer; warnEl.style.color = naer > 0 ? 'var(--wa)' : 'var(--g)'; }
  animV('api-avg', fmtKr(avg));
  if (varslerDiv) {
    if (!varsler.length) varslerDiv.innerHTML = '<div style="font-size:12.5px;color:var(--g);padding:4px 0;">âœ… Ingen aktive varsler.</div>';
    else varslerDiv.innerHTML = varsler.map(v => `<div style="display:flex;align-items:center;justify-content:space-between;background:${v.type==='over'?'rgba(255,61,61,.06)':'rgba(255,170,0,.06)'};border:1px solid ${v.type==='over'?'rgba(255,61,61,.2)':'rgba(255,170,0,.2)'};border-radius:9px;padding:12px 14px;"><div><div style="font-weight:700;font-size:12.5px;">${v.nm}</div><div style="font-size:11.5px;color:var(--m2);">${v.type==='over'?'Over grensen':'Naer grensen'}: ${fmtKr(v.kost)} / ${fmtKr(v.grense)}</div></div></div>`).join('');
  }
}

function varsleKlient(nm, kost, grense) {
  const over = kost > grense;
  const tekst = over
    ? `Hei! Vi ser at din API-kostnad denne maneden (${fmtKr(kost)}) har overskredet grensen (${fmtKr(grense)}).`
    : `Hei! Din API-kostnad naermer seg grensen. Navarende forbruk: ${fmtKr(kost)} av ${fmtKr(grense)}.`;
  navigator.clipboard.writeText(tekst).catch(() => {});
  toast('Varseltekst for ' + nm + ' kopiert', over ? 'err' : 'warn');
}

/* â”€â”€ FAKTURERING â”€â”€ */
async function renderFakturering() {
  const tb = el('fak-tbody'); if (!tb) return;
  const { data: invoices } = await sb.from('invoices').select('*, clients(name)').order('created_at', { ascending: false }).limit(20);
  if (!invoices?.length) {
    tb.innerHTML = '<tr><td colspan="5" style="text-align:center;padding:20px;color:var(--mu);">Ingen fakturaer enda</td></tr>';
    return;
  }
  tb.innerHTML = invoices.map(f => {
    const sClass = f.status === 'betalt' ? 'ba' : f.status === 'sendt' ? 'bp' : 'bd';
    return `<tr>
      <td style="font-weight:600;">${f.clients?.name || 'â€”'}</td>
      <td style="font-family:'DM Mono',monospace;font-weight:700;">${fmtKr(f.total_kr||0)}</td>
      <td style="color:var(--g);font-family:'DM Mono',monospace;font-size:11px;">${fmtKr(f.avtale_kr||0)}</td>
      <td class="tmn">${f.due_date || 'â€”'}</td>
      <td><span class="bge ${sClass}">${(f.status||'usendt').toUpperCase()}</span></td>
    </tr>`;
  }).join('');
}

/* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   â•‘  NEW CLIENT
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function pickTier(t) {
  selTier = t;
  document.querySelectorAll('.tsel').forEach(el2 => {
    const isMe = parseInt(el2.dataset.t) === t;
    const tc = { 1:'var(--t1)', 2:'var(--t2)', 3:'var(--t3)' }[t];
    const te = { 1:'var(--t1e)', 2:'var(--t2e)', 3:'var(--t3e)' }[t];
    const tb2 = { 1:'var(--t1b)', 2:'var(--t2b)', 3:'var(--t3b)' }[t];
    if (isMe) { el2.style.borderColor = te; el2.style.background = tb2; el2.querySelector('div').style.color = tc; }
    else { el2.style.borderColor = 'var(--b2)'; el2.style.background = 'var(--s2)'; el2.querySelector('div').style.color = 'var(--m2)'; }
  });
}

function ncCalcRoi() {
  const avtale = parseInt(el('nc-avtale')?.value) || 0;
  const besparing = parseInt(el('nc-besparing')?.value) || 0;
  const preview = el('nc-roi-preview');
  if (!avtale || !besparing) { if (preview) preview.style.display = 'none'; return; }
  const roi = (besparing / avtale).toFixed(1);
  const netto = besparing - avtale;
  const pct = Math.round(netto / besparing * 100);
  if (preview) preview.style.display = 'flex';
  const rv = el('nc-roi-val'), nv = el('nc-netto-val'), pv = el('nc-pct-val');
  if (rv) { rv.textContent = roi + 'x'; rv.style.color = roi >= 4 ? 'var(--g)' : roi >= 3 ? 'var(--au)' : 'var(--m2)'; }
  if (nv) nv.textContent = fmtKr(netto);
  if (pv) pv.textContent = pct + '%';
}

function ncGenPw() {
  const chars = 'abcdefghjkmnpqrstuvwxyzABCDEFGHJKMNPQRSTUVWXYZ23456789!@#';
  let pw = '';
  for (let i = 0; i < 12; i++) pw += chars[Math.floor(Math.random() * chars.length)];
  const pwEl = el('nc-pw');
  if (pwEl) { pwEl.value = pw; pwEl.style.color = 'var(--g)'; setTimeout(() => pwEl.style.color = '', 2000); }
}

async function addClient() {
  const nm = el('nc-nm')?.value?.trim();
  const cp = el('nc-cp')?.value?.trim();
  const email = el('nc-em')?.value?.trim();
  const pw = el('nc-pw')?.value?.trim();
  const br = el('nc-br')?.value || 'Annen';
  const avtaleKr = parseInt(el('nc-avtale')?.value) || 0;
  const besKr = parseInt(el('nc-besparing')?.value) || 0;
  if (!nm) { toast('Selskapsnavn er pakrevd', 'err'); return; }
  if (!avtaleKr) { toast('Fyll inn avtalepris', 'err'); return; }

  const tierColors = { 1:'#00e5a0', 2:'#2f8bff', 3:'#f59e0b' };
  const tierNames = { 1:'Liten', 2:'Medium', 3:'Stor' };
  const apiGrense = Math.round(avtaleKr * 0.2);
  const roi = avtaleKr ? (besKr / avtaleKr).toFixed(1) : 0;

  const btn = el('btn-add-client');
  btn.textContent = 'â³ Oppretter...'; btn.disabled = true;

  // 1. Create client
  const { data: client, error: clientErr } = await sb.from('clients').insert({
    name: nm, bransje: br, tier_id: selTier,
    contact_name: cp || '', contact_email: email || '',
    avtale_kr: avtaleKr, besparing_kr: besKr,
    avatar_letter: nm[0].toUpperCase(), avatar_color: tierColors[selTier],
    api_grense_kr: apiGrense,
  }).select().single();

  if (clientErr) {
    toast('Feil: ' + clientErr.message, 'err');
    btn.textContent = 'âœ… Opprett klient og bruker'; btn.disabled = false;
    return;
  }

  // 2. Create auth user + profile (if email provided)
  let finalPw = pw;
  if (!finalPw) { const chars = 'abcdefghjkmnpqrstuvwxyzABCDEFGHJKMNPQRSTUVWXYZ23456789'; finalPw = ''; for (let i = 0; i < 12; i++) finalPw += chars[Math.floor(Math.random() * chars.length)]; }

  if (email && email.includes('@')) {
    // Save admin session
    const { data: { session: adminSession } } = await sb.auth.getSession();

    const { data: signUpData, error: signUpErr } = await sb.auth.signUp({
      email, password: finalPw,
      options: { emailRedirectTo: window.location.origin }
    });

    // Restore admin session
    if (adminSession) await sb.auth.setSession(adminSession);

    if (signUpErr) {
      toast('Klient opprettet, men brukerkonto feilet: ' + signUpErr.message, 'warn');
    } else if (signUpData?.user) {
      const { data: userProfile } = await sb.from('users').insert({
        auth_id: signUpData.user.id, email,
        role: 'client', display_name: cp || nm, company: nm,
      }).select().single();

      if (userProfile) {
        await sb.from('client_users').insert({
          client_id: client.id, user_id: userProfile.id, is_primary: true,
        });
      }
    }
  }

  // 3. Refresh data
  await loadAdminData();
  renderClientsTable();
  renderUsersTable();
  updateAdminStats();
  closeModal('m-newcl');

  // Reset form
  ['nc-nm','nc-cp','nc-em','nc-pw','nc-avtale','nc-besparing'].forEach(id => { const e = el(id); if (e) e.value = ''; });
  const prev = el('nc-roi-preview'); if (prev) prev.style.display = 'none';

  btn.textContent = 'âœ… Opprett klient og bruker'; btn.disabled = false;

  // Fill done modal
  el('cl-done-nm').textContent = nm;
  el('cl-done-em').textContent = email || '(ingen e-post)';
  el('cl-done-pw').textContent = email ? finalPw : 'â€”';
  el('cl-done-tier').textContent = tierNames[selTier] + ' Â· Avtale: ' + fmtKr(avtaleKr) + (besKr ? ' Â· ROI: ' + roi + 'x' : '');
  el('cl-done-tier').style.color = tierColors[selTier];
  _lastClient = { nm, email, pw: finalPw, tier: selTier, tierName: tierNames[selTier], contact: cp, avtaleKr, besKr, roi };
  openModal('m-cl-done');
}

/* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   â•‘  CLIENT BOOT
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function bootClient() {
  // Get client membership
  const { data: memberships } = await sb.from('client_users').select('client_id').eq('user_id', CU.id);
  if (!memberships?.length) { toast('Ingen klient tilknyttet din konto', 'err'); return; }

  const clientId = memberships[0].client_id;
  const { data: client } = await sb.from('clients').select('*').eq('id', clientId).single();
  if (!client) { toast('Klientdata ikke funnet', 'err'); return; }

  const { data: agents } = await sb.from('agents').select('*').eq('client_id', clientId);
  const mappedAgents = (agents || []).map(a => mapAgent({ ...a, client_name: client.name }));

  const { data: apiKeys } = await sb.from('client_api_keys').select('*').eq('client_id', clientId);
  const keys = {};
  (apiKeys || []).forEach(k => { keys[k.key_type] = k.key_value; });

  const totalActions = mappedAgents.reduce((s, a) => s + a.act, 0);
  const tierIcons = { 1:'ğŸ¢', 2:'ğŸš€', 3:'ğŸ†' };

  // Populate CU with expected fields
  CU.company = client.name;
  CU.tier = client.tier_id;
  CU.icon = tierIcons[client.tier_id] || 'ğŸ¢';
  CU.color = client.avatar_color || '#2f8bff';
  CU.clientId = clientId;
  CU.stats = { actions: totalActions, leads: 0, voices: 0 };
  CU.avtaleKr = client.avtale_kr || 0;
  CU.besparingKr = client.besparing_kr || 0;
  CU.timeSaved = Math.round((client.besparing_kr || 0) / 600);
  CU.apiKostKr = parseFloat(client.api_kost_kr) || 0;
  CU.apiGrenseKr = parseFloat(client.api_grense_kr) || 0;
  CU.contact = client.contact_name || '';
  CU.generalKnowledge = client.general_knowledge || '';
  CU.voiceProvider = client.voice_provider || 'VAPI';
  CU.keyOpenAI = keys.openai || '';
  CU.keyVapi = keys.vapi || '';
  CU.keyElevenLabs = keys.elevenlabs || '';
  CU.keyTwilioSid = keys.twilio_sid || '';
  CU.keyTwilioToken = keys.twilio_token || '';
  CU.keyHubspot = keys.hubspot || '';
  CU.n8nUrl = client.n8n_url || '';
  CU.webhookUrl = client.webhook_url || '';

  // Set AGENTS to this client's agents
  AGENTS = mappedAgents;
  CU.agentIdx = AGENTS.map((_, i) => i);

  const u = CU;
  const tc = TIER_CFG[u.tier];
  const agentCount = AGENTS.length;
  const isMaxed = agentCount >= tc.max;
  const isWarn = !isMaxed && (agentCount / tc.max) >= 0.8;

  // Topbar
  el('c-icon').textContent = u.icon;
  el('c-name').textContent = u.company;
  el('c-av').textContent = u.company[0];
  el('c-tbadge').textContent = u.icon;
  el('c-tbadge').style.background = u.tier === 1 ? 'rgba(0,229,160,0.15)' : u.tier === 2 ? 'rgba(47,139,255,0.15)' : 'rgba(245,158,11,0.15)';
  el('c-greet').textContent = u.company;

  // Capacity banners
  el('c-tier-alert').style.display = 'none';
  el('c-tier-warn').style.display = 'none';
  el('c-ag-alert').style.display = 'none';
  if (isMaxed) {
    const desc = `Du bruker alle ${tc.max} agenter. Kontakt SCS for a utvide avtalen.`;
    el('c-alert-desc').textContent = desc;
    el('c-ag-alert-desc').textContent = desc;
    el('c-tier-alert').style.display = 'flex';
    el('c-ag-alert').style.display = 'flex';
  } else if (isWarn) {
    el('c-warn-desc').textContent = `Du bruker ${agentCount} av ${tc.max} agenter (${Math.round(agentCount/tc.max*100)}%).`;
    el('c-tier-warn').style.display = 'flex';
  }

  const supUp = el('c-sup-upgrade');
  if (supUp) supUp.style.display = isMaxed ? 'block' : 'none';

  // Settings
  const setEm = el('c-set-em'); if (setEm) setEm.value = CU.email;
  const setCo = el('c-set-co'); if (setCo) setCo.value = u.company;
  const setCp = el('c-set-cp'); if (setCp) setCp.value = u.contact || '';

  updateClientROI();
  renderClientAgList();
  renderClientAgCards();
  renderClientActLog();
  buildClientCharts();

  const apiKostEl = el('c-api-kost');
  if (apiKostEl) apiKostEl.textContent = fmtKr(u.apiKostKr || 0);

  // Voice provider
  const cl = client;
  const vp = cl.voice_provider || 'VAPI';
  const vpInfo = {
    'VAPI': { name:'ğŸ“ VAPI', desc:'Alt-i-ett voice AI-platform.' },
    'ElevenLabs': { name:'ğŸ™ ElevenLabs + VAPI', desc:'Naturlig norsk tale via ElevenLabs.' },
    'Twilio': { name:'ğŸ“ Twilio', desc:'Telefoni via Twilio med norsk nummer.' },
  };
  const vpi = vpInfo[vp] || vpInfo['VAPI'];
  const nmEl2 = el('c-voice-provider-name'), dscEl = el('c-voice-provider-desc');
  if (nmEl2) nmEl2.textContent = vpi.name;
  if (dscEl) dscEl.textContent = vpi.desc;

  const kf = el('c-voice-key-fields');
  if (kf) {
    if (vp === 'ElevenLabs') {
      kf.innerHTML = '<div style="margin-bottom:8px;"><label class="fgl">ElevenLabs API Key</label><div style="display:flex;gap:7px;"><input class="fgi" id="c-key-elevenlabs" placeholder="el_..." style="flex:1;font-family:monospace;font-size:11px;"><a href="https://elevenlabs.io/app" target="_blank" class="btn btn-gh btn-sm">â†—</a></div></div><input type="hidden" id="c-key-vapi" value=""><input type="hidden" id="c-key-twilio-sid" value=""><input type="hidden" id="c-key-twilio-token" value="">';
    } else if (vp === 'Twilio') {
      kf.innerHTML = '<div style="margin-bottom:8px;"><label class="fgl">Twilio Account SID</label><div style="display:flex;gap:7px;"><input class="fgi" id="c-key-twilio-sid" placeholder="AC..." style="flex:1;font-family:monospace;font-size:11px;"><a href="https://console.twilio.com" target="_blank" class="btn btn-gh btn-sm">â†—</a></div></div><div><label class="fgl">Twilio Auth Token</label><input class="fgi" id="c-key-twilio-token" placeholder="Auth Token..." style="width:100%;font-family:monospace;font-size:11px;"></div><input type="hidden" id="c-key-vapi" value=""><input type="hidden" id="c-key-elevenlabs" value="">';
    } else {
      kf.innerHTML = '<div><label class="fgl">VAPI API Key</label><div style="display:flex;gap:7px;"><input class="fgi" id="c-key-vapi" placeholder="vapi_..." style="flex:1;font-family:monospace;font-size:11px;"><a href="https://vapi.ai/dashboard" target="_blank" class="btn btn-gh btn-sm">â†—</a></div></div><input type="hidden" id="c-key-elevenlabs" value=""><input type="hidden" id="c-key-twilio-sid" value=""><input type="hidden" id="c-key-twilio-token" value="">';
    }
    if (el('c-key-openai'))       el('c-key-openai').value       = u.keyOpenAI || '';
    if (el('c-key-vapi'))         el('c-key-vapi').value         = u.keyVapi || '';
    if (el('c-key-elevenlabs'))   el('c-key-elevenlabs').value   = u.keyElevenLabs || '';
    if (el('c-key-twilio-sid'))   el('c-key-twilio-sid').value   = u.keyTwilioSid || '';
    if (el('c-key-twilio-token')) el('c-key-twilio-token').value = u.keyTwilioToken || '';
    if (el('c-key-hubspot'))      el('c-key-hubspot').value      = u.keyHubspot || '';
    if (el('c-n8n-url'))          el('c-n8n-url').value          = u.n8nUrl || '';
    if (el('c-webhook-url'))      el('c-webhook-url').value      = u.webhookUrl || '';
  }
  setTimeout(renderClientAgentConfig, 100);
}

function updateClientROI() {
  const u = CU; if (!u) return;
  const netto = u.besparingKr - u.avtaleKr;
  const roi = u.avtaleKr ? (u.besparingKr / u.avtaleKr).toFixed(1) : '0';
  const pct = u.besparingKr ? Math.round(netto / u.besparingKr * 100) : 0;

  el('c-hero-besparing').textContent = fmtKr(u.besparingKr);
  el('c-hero-avtale').textContent = fmtKr(u.avtaleKr);
  el('c-hero-netto').textContent = fmtKr(netto);
  el('c-hero-roi').textContent = 'ROI: ' + roi + 'x';
  el('c-roi-h').textContent = u.timeSaved + 't';
  el('c-roi-s').textContent = fmtKr(u.besparingKr);
  el('c-plan-cost').textContent = fmtKr(u.avtaleKr);
  el('c-roi-n').textContent = fmtKr(netto);
  el('c-roi-x').textContent = roi + 'x';
  el('c-roi-pct').textContent = ' Â· du beholder ' + pct + '% av besparelsen';
  el('c-s-ag').textContent = AGENTS.length;
  el('c-s-act').textContent = (u.stats.actions || 0).toLocaleString('no-NO');
  el('c-s-leads').textContent = u.stats.leads || 0;
  el('c-s-tid').textContent = u.timeSaved + 't';
}

function buildClientCharts() {
  const u = CU;
  const actVals = AGENTS.map(a => a.act || 0);
  buildChart('c-chart1', 'var(--b1)', actVals.length ? actVals : [0]);
  el('c-ch1-val').textContent = (u.stats.actions || 0).toLocaleString('no-NO');
}

function renderClientAgList() {
  const list = el('c-aglist'); if (!list) return;
  if (!AGENTS.length) { list.innerHTML = '<div style="padding:16px;color:var(--mu);font-size:12.5px;text-align:center;">Ingen agenter enda. SCS setter dem opp for deg!</div>'; return; }
  list.innerHTML = AGENTS.map(a => {
    const rc = a.rate >= 90 ? 'var(--g)' : a.rate >= 80 ? 'var(--o)' : 'var(--er)';
    return `<div style="display:flex;align-items:center;gap:11px;padding:11px 16px;border-bottom:1px solid rgba(47,139,255,.06);">
      <div style="width:30px;height:30px;border-radius:8px;background:${a.bg};display:flex;align-items:center;justify-content:center;font-size:13px;flex-shrink:0;">${a.em}</div>
      <div style="flex:1;"><div style="font-weight:600;font-size:12.5px;">${a.nm}</div><div class="tmn" style="margin-top:1px;">${a.ch}</div></div>
      <div style="text-align:right;"><div style="font-family:'DM Mono',monospace;font-size:11px;color:var(--g);">${a.act.toLocaleString('no-NO')} handl.</div><div style="font-family:'DM Mono',monospace;font-size:11px;color:${rc};">${a.rate}% ok</div></div>
      <span class="bge ba" style="font-size:9px;">AKTIV</span>
    </div>`;
  }).join('');
}

function renderClientAgCards() {
  const g = el('c-agcards'); if (!g) return;
  if (!AGENTS.length) { g.innerHTML = '<div class="ccard" style="padding:30px;text-align:center;grid-column:1/-1;"><div style="font-size:28px;margin-bottom:8px;">ğŸ¤–</div><div style="color:var(--mu);font-size:13px;">Ingen agenter enda.</div></div>'; return; }
  g.innerHTML = AGENTS.map(a => {
    const rc = a.rate >= 90 ? 'var(--g)' : a.rate >= 80 ? 'var(--o)' : 'var(--er)';
    return `<div class="ccard" style="padding:17px;">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px;">
        <div style="width:36px;height:36px;border-radius:9px;background:${a.bg};display:flex;align-items:center;justify-content:center;font-size:16px;">${a.em}</div>
        <div><div style="font-weight:700;font-size:13px;">${a.nm}</div><div class="tmn" style="margin-top:2px;">${a.ch}</div></div>
        <span class="bge ba" style="margin-left:auto;">AKTIV</span>
      </div>
      <div style="display:flex;gap:14px;border-top:1px solid rgba(47,139,255,.06);padding-top:11px;">
        <div><div style="font-family:'Instrument Sans',sans-serif;font-weight:600;font-size:19px;">${a.act.toLocaleString('no-NO')}</div><div class="tmn">Handlinger</div></div>
        <div><div style="font-family:'Instrument Sans',sans-serif;font-weight:600;font-size:16px;color:${rc};">${a.rate}%</div><div class="tmn">Suksessrate</div></div>
      </div>
    </div>`;
  }).join('');
}

function renderClientActLog() {
  const log = el('c-actlog'); if (!log) return;
  log.innerHTML = '';
  if (AGENTS.length) for (let i = 0; i < 8; i++) pushClientFeedTo(log, false);
  else log.innerHTML = '<div style="padding:16px;color:var(--mu);font-size:12.5px;text-align:center;">Ingen aktivitet enda.</div>';
  const cfeed = el('c-feed'); if (!cfeed) return;
  cfeed.innerHTML = '';
  if (AGENTS.length) for (let i = 0; i < 5; i++) pushClientFeedTo(cfeed, false, true);
}

function pushClientFeedTo(container, flash = true, mini = false) {
  const t = ACT_T[Math.floor(Math.random() * ACT_T.length)];
  const now = new Date().toLocaleTimeString('no-NO');
  const a = AGENTS.length ? AGENTS[Math.floor(Math.random() * AGENTS.length)] : { nm: 'â€”' };
  const d = document.createElement('div');
  if (mini) {
    d.className = 'ti' + (flash ? ' fnb' : '');
    d.innerHTML = `<span class="tibg tiau">${t.ic}</span><div style="flex:1;"><div style="font-size:12px;font-weight:500;">${t.msg(a.nm)}</div><div class="tmn" style="margin-top:1px;">${now} Â· ${a.nm}</div></div>`;
  } else {
    d.className = 'ai' + (flash ? ' fnb' : '');
    d.innerHTML = `<div class="aic" style="background:${t.bg}">${t.ic}</div><div><div style="font-size:12px;">${t.msg(a.nm)}</div><div class="tmn" style="margin-top:1px;">${now} Â· ${a.nm}</div></div>`;
  }
  container.insertBefore(d, container.firstChild);
  while (container.children.length > (mini ? 5 : 8)) container.removeChild(container.lastChild);
}

/* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   â•‘  DYNAMIC MODALS
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openDynModal(id, html) {
  let mo = el(id);
  if (!mo) {
    mo = document.createElement('div');
    mo.className = 'mo'; mo.id = id;
    mo.innerHTML = '<div class="mbox" style="width:min(560px,94vw);"></div>';
    document.body.appendChild(mo);
    mo.addEventListener('click', e => { if (e.target === mo) mo.classList.remove('on'); });
  }
  mo.querySelector('.mbox').innerHTML = html;
  mo.classList.add('on');
  mo.querySelectorAll('.mo-close').forEach(btn => btn.addEventListener('click', () => mo.classList.remove('on')));
}

/* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   â•‘  SUPABASE SETTINGS
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function loadSavedConfig() {
  try {
    const saved = JSON.parse(localStorage.getItem('scs_sb') || '{}');
    if (saved.url) { const e2 = el('sb-url'); if (e2) e2.value = saved.url; }
    if (saved.key) { const e2 = el('sb-key'); if (e2) e2.value = saved.key; }
  } catch {}
}

function saveSettings() {
  const url = el('sb-url')?.value?.trim() || '';
  const key = el('sb-key')?.value?.trim() || '';
  try { localStorage.setItem('scs_sb', JSON.stringify({ url, key })); } catch {}
  if (url && key) { initSupabase(); }
  toast('Innstillinger lagret. Last siden pa nytt for a aktivere.');
}

async function testSupabase() {
  const msg = el('sb-test-msg'), badge = el('set-conn-badge');
  const url = el('sb-url')?.value?.trim();
  const key = el('sb-key')?.value?.trim();
  if (!url || !key) { if (msg) { msg.textContent = 'âš ï¸ Fyll inn URL og Key forst'; msg.style.color = 'var(--wa)'; } return; }
  if (msg) { msg.textContent = 'â³ Tester...'; msg.style.color = 'var(--mu)'; }
  try {
    const testSb = window.supabase.createClient(url, key);
    const { data, error } = await testSb.from('tiers').select('*').limit(1);
    if (error) throw error;
    if (msg) { msg.textContent = 'âœ… Tilkoblet!'; msg.style.color = 'var(--g)'; }
    if (badge) badge.innerHTML = '<span class="bge ba"><span class="ld"></span> Tilkoblet</span>';
  } catch (e) {
    if (msg) { msg.textContent = 'âŒ Feil: ' + (e.message || 'Ukjent'); msg.style.color = 'var(--er)'; }
  }
}

/* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   â•‘  CLIENT AGENT CONFIG
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderClientAgentConfig() {
  const u = CU;
  const container = el('c-agent-config-list');
  if (!container || !u) return;

  let out = '<div style="background:rgba(0,229,160,.04);border:1px solid rgba(0,229,160,.15);border-radius:11px;padding:14px;margin-bottom:2px;">'
    + '<div style="font-size:11.5px;color:var(--m2);margin-bottom:10px;">'
    + (AGENTS.length
        ? '<span style="font-weight:700;color:var(--g);">ğŸ“š Generell kunnskap</span> â€” deles med alle agentene dine.'
        : '<span style="font-weight:700;color:var(--g);">â„¹ï¸ SCS setter opp agentene dine.</span> Du kan allerede legge inn informasjon.')
    + '</div>'
    + '<div class="fg1"><textarea class="fgt" id="cl-general-knowledge" style="height:100px;font-size:12px;" placeholder="Produktinfo, priser, FAQ, rutiner...">'
    + (u.generalKnowledge||'') + '</textarea></div>'
    + '<button class="btn btn-g btn-sm" id="cl-save-general-know" style="margin-top:8px;width:100%;">ğŸ’¾ Lagre kunnskap</button>'
    + '</div>';

  AGENTS.forEach(a => {
    out += '<div style="border:1px solid var(--b2);border-radius:11px;padding:14px;background:var(--s3);">'
      + '<div style="display:flex;align-items:center;gap:9px;margin-bottom:10px;">'
      + '<div style="width:34px;height:34px;border-radius:8px;background:' + a.bg + ';display:flex;align-items:center;justify-content:center;font-size:15px;">' + (a.em||'ğŸ¤–') + '</div>'
      + '<div style="flex:1;"><div style="font-weight:700;font-size:13px;">' + a.nm + '</div><div style="font-size:11px;color:var(--m2);">' + (a.ch||'â€”') + '</div></div>'
      + '<span class="bge ' + (a.status==='aktiv'?'ba':'bp') + '" style="font-size:9px;">' + (a.status||'aktiv').toUpperCase() + '</span></div>'
      + (a.knowledge ? '<div style="background:var(--bg);border:1px solid rgba(0,229,160,.2);border-radius:8px;padding:9px 12px;margin-bottom:10px;"><div style="font-size:10px;font-weight:700;color:var(--g);text-transform:uppercase;letter-spacing:.8px;margin-bottom:4px;">Aktiv kunnskap fra SCS</div><div style="font-size:12px;color:var(--m2);white-space:pre-wrap;max-height:70px;overflow-y:auto;">' + a.knowledge + '</div></div>' : '')
      + '<div class="fg1" style="margin-bottom:8px;"><label class="fgl">ğŸ“ Din tilleggskunnskap for ' + a.nm + '</label>'
      + '<textarea class="fgt cl-ag-knowledge" data-aid="' + a.id + '" style="height:75px;font-size:12px;" placeholder="Spesifikk info, rutiner, instrukser...">' + (a.clientKnowledge||'') + '</textarea></div>'
      + '<div class="fg1" style="margin-bottom:8px;"><label class="fgl">ğŸ’¬ Innspill til SCS</label>'
      + '<textarea class="fgt cl-ag-feedback" data-aid="' + a.id + '" style="height:50px;font-size:12px;" placeholder="F.eks.: Agenten bor nevne ny pakke.">' + (a.clientFeedback||'') + '</textarea></div>'
      + '<button class="btn btn-g btn-sm cl-ag-save" data-aid="' + a.id + '" style="width:100%;">ğŸ’¾ Lagre</button></div>';
  });

  container.innerHTML = out;

  const gBtn = el('cl-save-general-know');
  if (gBtn) gBtn.addEventListener('click', async () => {
    const val = (el('cl-general-knowledge')||{}).value || '';
    await sb.from('clients').update({ general_knowledge: val }).eq('id', CU.clientId);
    CU.generalKnowledge = val;
    toast('Kunnskap lagret');
  });

  container.querySelectorAll('.cl-ag-save').forEach(btn => {
    btn.addEventListener('click', async () => {
      const aid = btn.dataset.aid;
      const card = btn.closest('div[style*="border:1px solid var(--b2)"]');
      if (!card) return;
      const kt = card.querySelector('.cl-ag-knowledge');
      const ft = card.querySelector('.cl-ag-feedback');
      const updates = {};
      if (kt) updates.client_knowledge = kt.value.trim();
      if (ft) updates.client_feedback = ft.value.trim();
      await sb.from('agents').update(updates).eq('id', aid);
      toast('Lagret');
    });
  });
}

/* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   â•‘  EVENT LISTENERS
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.addEventListener('DOMContentLoaded', () => {
  loadSavedConfig();

  // Check for existing session
  if (sb) {
    sb.auth.getSession().then(async ({ data: { session } }) => {
      if (session) {
        const { data: profile } = await sb.from('users').select('*').eq('auth_id', session.user.id).single();
        if (profile) {
          CU = profile;
          el('v-login').classList.remove('on');
          if (CU.role === 'admin') { el('v-admin').classList.add('on'); await bootAdmin(); }
          else { el('v-client').classList.add('on'); await bootClient(); }
        }
      }
    });
  }

  /* â”€â”€ Login â”€â”€ */
  el('rtab-admin').addEventListener('click', () => {
    loginRole = 'admin';
    el('rtab-admin').classList.add('on'); el('rtab-client').classList.remove('on');
    el('rtab-admin').classList.add('at');
    el('lbtn').className = 'lbtn lbtn-a';
    el('lbtn-tx').textContent = 'Logg inn som Admin';
    el('lbtn-ic').textContent = 'âš¡';
    document.querySelectorAll('.fi').forEach(i => i.classList.remove('cf'));
    el('lerr').classList.remove('on');
  });
  el('rtab-client').addEventListener('click', () => {
    loginRole = 'client';
    el('rtab-client').classList.add('on'); el('rtab-admin').classList.remove('on');
    el('lbtn').className = 'lbtn lbtn-c';
    el('lbtn-tx').textContent = 'Logg inn som Klient';
    el('lbtn-ic').textContent = 'ğŸ‘¤';
    document.querySelectorAll('.fi').forEach(i => i.classList.add('cf'));
    el('lerr').classList.remove('on');
  });
  el('lbtn').addEventListener('click', doLogin);
  el('lin-em').addEventListener('keydown', e => { if (e.key === 'Enter') doLogin(); });
  el('lin-pw').addEventListener('keydown', e => { if (e.key === 'Enter') doLogin(); });

  /* â”€â”€ API save handler â”€â”€ */
  const lapiBtn = el('btn-lagre-api-setup');
  if (lapiBtn) lapiBtn.addEventListener('click', async () => {
    const u = CU; if (!u || !u.clientId) return;
    const keyMap = {
      'c-key-openai': 'openai', 'c-key-vapi': 'vapi', 'c-key-elevenlabs': 'elevenlabs',
      'c-key-twilio-sid': 'twilio_sid', 'c-key-twilio-token': 'twilio_token', 'c-key-hubspot': 'hubspot',
    };
    const promises = [];
    for (const [elemId, keyType] of Object.entries(keyMap)) {
      const val = (el(elemId)||{}).value || '';
      if (val) {
        promises.push(sb.from('client_api_keys').upsert(
          { client_id: u.clientId, key_type: keyType, key_value: val },
          { onConflict: 'client_id,key_type' }
        ));
      }
    }
    // Save n8n + webhook on client
    const clientUpdates = {};
    const n8nVal = (el('c-n8n-url')||{}).value; if (n8nVal !== undefined) clientUpdates.n8n_url = n8nVal;
    const whVal = (el('c-webhook-url')||{}).value; if (whVal !== undefined) clientUpdates.webhook_url = whVal;
    if (Object.keys(clientUpdates).length) {
      promises.push(sb.from('clients').update(clientUpdates).eq('id', u.clientId));
    }
    await Promise.all(promises);
    toast('Nokler lagret');
  });

  /* â”€â”€ Webhook copy â”€â”€ */
  const whCopy = el('c-webhook-copy');
  if (whCopy) whCopy.addEventListener('click', () => {
    const v = (el('c-webhook-url')||{}).value || '';
    if (v) { navigator.clipboard?.writeText(v); toast('URL kopiert'); }
    else toast('Ingen URL a kopiere', 'warn');
  });

  /* â”€â”€ Client settings save â”€â”€ */
  const cSetSave = el('btn-lagre-klient-set');
  if (cSetSave) cSetSave.addEventListener('click', async () => {
    const u = CU; if (!u || !u.clientId) return;
    const co = (el('c-set-co')||{}).value;
    const cp = (el('c-set-cp')||{}).value;
    const updates = {};
    if (co) { updates.name = co; u.company = co; }
    if (cp !== undefined) { updates.contact_name = cp; u.contact = cp; }
    if (Object.keys(updates).length) {
      await sb.from('clients').update(updates).eq('id', u.clientId);
    }
    const nmEl3 = el('c-name'); if (nmEl3 && co) nmEl3.textContent = co;
    toast('Innstillinger lagret');
  });

  /* â”€â”€ Admin nav â”€â”€ */
  document.querySelectorAll('.ani[data-page]').forEach(item => {
    item.addEventListener('click', () => aGo(item.dataset.page));
  });
  document.querySelectorAll('[data-goto]').forEach(btn => {
    btn.addEventListener('click', () => aGo(btn.dataset.goto));
  });

  /* â”€â”€ Client nav â”€â”€ */
  document.querySelectorAll('.cni[data-cpage]').forEach(item => {
    item.addEventListener('click', () => {
      cGo(item.dataset.cpage);
      if (item.dataset.cpage === 'c-api') setTimeout(renderClientAgentConfig, 60);
    });
  });
  document.querySelectorAll('[data-cpage]:not(.cni)').forEach(btn => {
    btn.addEventListener('click', () => cGo(btn.dataset.cpage));
  });

  /* â”€â”€ Modal open triggers â”€â”€ */
  document.querySelectorAll('[data-modal]').forEach(btn => {
    btn.addEventListener('click', () => openModal(btn.dataset.modal));
  });

  /* â”€â”€ Modal close â”€â”€ */
  document.querySelectorAll('.mo-close').forEach(btn => {
    btn.addEventListener('click', () => btn.closest('.mo').classList.remove('on'));
  });
  document.querySelectorAll('.mo').forEach(mo => {
    mo.addEventListener('click', e => { if (e.target === mo) mo.classList.remove('on'); });
  });

  /* â”€â”€ Logout â”€â”€ */
  el('a-logout-btn').addEventListener('click', logout);
  el('c-logout-btn').addEventListener('click', logout);

  /* â”€â”€ Ny klient â”€â”€ */
  el('btn-newcl').addEventListener('click', () => { ncGenPw(); openModal('m-newcl'); });
  el('btn-nc-genpw').addEventListener('click', ncGenPw);
  el('nc-avtale').addEventListener('input', ncCalcRoi);
  el('nc-besparing').addEventListener('input', ncCalcRoi);
  el('btn-add-client').addEventListener('click', addClient);

  /* Tier selector */
  document.querySelectorAll('.tsel').forEach(ts => {
    ts.addEventListener('click', () => pickTier(parseInt(ts.dataset.t)));
  });
  pickTier(1);

  /* Klient opprettet modal */
  el('btn-kopier-tilgang').addEventListener('click', () => {
    const email = el('cl-done-em').textContent;
    const pw2 = el('cl-done-pw').textContent;
    navigator.clipboard.writeText(`E-post: ${email}\nPassord: ${pw2}`).catch(() => {});
    toast('Innloggingsdetaljer kopiert');
  });
  el('btn-kopier-velkost').addEventListener('click', () => {
    const c = _lastClient;
    const tekst = `Hei${c.contact?' '+c.contact:''}!\n\nVelkommen som klient hos Simply Complex Solutions!\n\nInnlogging:\n- URL: ${window.location.href}\n- E-post: ${c.email||''}\n- Passord: ${c.pw||''}\n\nDin avtale: ${fmtKr(c.avtaleKr||0)}\n\nTa kontakt pa hei@simplycomplex.no om du har sporsmal.\n\nBeste hilsener,\nSCS-teamet`;
    navigator.clipboard.writeText(tekst).catch(() => {});
    toast('Velkomsttekst kopiert');
  });
  el('btn-send-velkost').addEventListener('click', () => {
    const c = _lastClient;
    if (!c || !c.email) { toast('Ingen e-post oppgitt', 'err'); return; }
    const subject = encodeURIComponent('Velkommen til SCS kundeportal');
    const body = encodeURIComponent(`Hei${c.contact ? ' ' + c.contact : ''}!\n\nVelkommen som klient hos Simply Complex Solutions!\n\nDu kan logge inn her:\n${window.location.href}\n\nInnlogging:\nE-post: ${c.email}\nPassord: ${c.pw}\n\nDin avtale: ${c.tierName} - ${fmtKr(c.avtaleKr || 0)}/mnd\n\nTa kontakt pÃ¥ hei@simplycomplex.no om du har spÃ¸rsmÃ¥l.\n\nBeste hilsener,\nSCS-teamet`);
    window.open(`mailto:${c.email}?subject=${subject}&body=${body}`, '_blank');
  });
  el('btn-goto-kl').addEventListener('click', () => { closeModal('m-cl-done'); aGo('a-kl'); });

  /* â”€â”€ Be om flere agenter â”€â”€ */
  el('upg-send-btn').addEventListener('click', async () => {
    const antall = el('upg-antall').value.trim();
    const msg = el('upg-msg').value.trim();
    if (!antall) { toast('Angi antall agenter du onsker', 'err'); return; }
    if (CU?.clientId) {
      await sb.from('support_tickets').insert({
        client_id: CU.clientId, user_id: CU.id,
        subject: 'ForespÃ¸rsel: ' + antall + ' nye agenter',
        description: msg || 'Ingen ekstra info',
        priority: 2,
      });
    }
    el('upg-antall').value = ''; el('upg-msg').value = '';
    closeModal('m-upgrade');
    toast('ForespÃ¸rsel sendt til SCS');
  });

  /* â”€â”€ Inviter bruker â”€â”€ */
  el('btn-invuser').addEventListener('click', () => openModal('m-invuser'));
  el('btn-do-inviter').addEventListener('click', () => {
    const nm = el('inv-nm').value.trim();
    const em = el('inv-em').value.trim();
    if (!nm || !em) { toast('Navn og e-post pakrevd', 'err'); return; }
    el('inv-nm').value = ''; el('inv-em').value = '';
    closeModal('m-invuser');
    toast('Invitasjon sendt til ' + nm);
  });

  /* â”€â”€ Klient: sok og filter â”€â”€ */
  el('cl-search').addEventListener('input', () => renderClientsTable(el('cl-search').value, el('cl-tier-filter').value));
  el('cl-tier-filter').addEventListener('change', () => renderClientsTable(el('cl-search').value, el('cl-tier-filter').value));

  /* â”€â”€ Ny agent â”€â”€ */
  el('btn-opprett-agent').addEventListener('click', async () => {
    const nm = el('ny-nm').value.trim();
    const klient = el('ny-klient').value;
    if (!nm) { toast('Skriv inn agentnavn forst', 'err'); return; }

    const cl = CLIENTS.find(c => c.n === klient);
    if (!cl) { toast('Velg en klient forst', 'err'); return; }

    const btn = el('btn-opprett-agent');
    btn.textContent = 'â³ Oppretter...'; btn.disabled = true;

    const { error } = await sb.from('agents').insert({
      client_id: cl.id, name: nm,
      channels: el('ny-kanal').value.replace(/^[^ ]+ /, ''),
      emoji: 'ğŸ¤–', bg_color: 'rgba(0,229,160,.08)',
    });

    if (error) { toast('Feil: ' + error.message, 'err'); }
    else {
      await loadAdminData();
      renderAgentCards();
      updateAdminStats();
      el('ny-nm').value = '';
      toast(`Agent "${nm}" opprettet`);
      aGo('a-ag');
    }
    btn.textContent = 'âš¡ Aktiver agent'; btn.disabled = false;
  });

  /* â”€â”€ Populate klient dropdown â”€â”€ */
  function populateClientDropdown() {
    const sel = el('ny-klient'); if (!sel) return;
    const opts = sel.querySelectorAll('option:not(:first-child)');
    opts.forEach(o => o.remove());
    CLIENTS.forEach(cl => {
      const opt = document.createElement('option');
      opt.textContent = cl.n; sel.appendChild(opt);
    });
  }

  // Observer: re-populate dropdown when navigating to "ny agent" page
  const origAGo = aGo;
  window.aGoWrap = function(pg) { origAGo(pg); if (pg === 'a-ny') populateClientDropdown(); };
  document.querySelectorAll('.ani[data-page]').forEach(item => {
    item.removeEventListener('click', () => {});
    item.addEventListener('click', () => { origAGo(item.dataset.page); if (item.dataset.page === 'a-ny') populateClientDropdown(); });
  });
  document.querySelectorAll('[data-goto]').forEach(btn => {
    btn.addEventListener('click', () => { origAGo(btn.dataset.goto); if (btn.dataset.goto === 'a-ny') populateClientDropdown(); });
  });

  /* â”€â”€ Integrasjoner â”€â”€ */
  document.querySelectorAll('.int-koble-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      btn.textContent = 'â³ Kobler...'; btn.disabled = true;
      setTimeout(() => {
        const badge = btn.previousElementSibling;
        if (badge) { badge.textContent = 'TILKOBLET'; badge.className = 'bge ba'; }
        btn.textContent = 'âœ“ Tilkoblet'; btn.disabled = false;
        toast('Tilkoblet');
      }, 1100);
    });
  });

  /* â”€â”€ Supabase settings â”€â”€ */
  el('btn-test-sb').addEventListener('click', testSupabase);
  el('btn-save-settings').addEventListener('click', saveSettings);
  el('btn-copy-webhook').addEventListener('click', () => {
    const webhookEl = el('webhook-url');
    navigator.clipboard.writeText(webhookEl.textContent).catch(() => {});
    webhookEl.style.color = 'var(--g)'; setTimeout(() => webhookEl.style.color = '', 1500);
    toast('Webhook URL kopiert');
  });
  el('btn-open-sb').addEventListener('click', () => window.open('https://supabase.com/dashboard','_blank'));
  el('btn-open-n8n').addEventListener('click', () => window.open('https://app.n8n.cloud','_blank'));

  /* â”€â”€ Email/Voice save â”€â”€ */
  el('btn-save-email').addEventListener('click', () => toast('Email-konfig lagret'));
  el('btn-save-voice').addEventListener('click', () => toast('Voice-konfig lagret'));
  el('btn-export-api').addEventListener('click', () => toast('Rapport eksportert'));

  /* â”€â”€ Glemt passord â”€â”€ */
  el('l-forgot').addEventListener('click', () => openModal('m-glemt-pw'));
  el('btn-forgot-send').addEventListener('click', async () => {
    const em = (el('forgot-em')||{}).value;
    if (!em) { toast('Fyll inn e-post', 'err'); return; }
    if (sb) {
      const { error } = await sb.auth.resetPasswordForEmail(em, { redirectTo: window.location.origin });
      if (error) toast('Feil: ' + error.message, 'err');
      else toast('Tilbakestillingslenke sendt til ' + em);
    }
    closeModal('m-glemt-pw');
  });

  /* â”€â”€ Pause alle agenter â”€â”€ */
  el('btn-pause-alle').addEventListener('click', async () => {
    if (!confirm('Pause ALLE agenter?')) return;
    await sb.from('agents').update({ status: 'pauset' }).neq('status', 'feil');
    await loadAdminData();
    renderAgentCards();
    toast('Alle agenter pausert', 'warn');
  });

  /* â”€â”€ Support sak â”€â”€ */
  el('btn-send-sak').addEventListener('click', async () => {
    const emne = el('sup-emne')?.value?.trim() || '';
    if (!emne) { toast('Skriv inn emne forst', 'err'); return; }
    el('btn-send-sak').textContent = 'â³ Sender...'; el('btn-send-sak').disabled = true;
    if (CU?.clientId) {
      await sb.from('support_tickets').insert({
        client_id: CU.clientId, user_id: CU.id,
        subject: emne, description: '', priority: 2,
      });
    }
    setTimeout(() => {
      toast('Sak "' + emne.slice(0, 28) + '" sendt');
      el('sup-emne').value = '';
      el('btn-send-sak').textContent = 'ğŸ“¤ Send sak'; el('btn-send-sak').disabled = false;
    }, 400);
  });
});

</script>
</body>
</html>
